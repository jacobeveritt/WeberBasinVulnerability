#Iterate Flows in yearly segments of Average annual#######
### Clear any existing data or functions.
rm(list=ls())
## Linear Average looking forward 

setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerablity/Scenario Processing/Annual Average Streamflow Scenario Selection")
library("viridisLite")

#Input Data###############################################
library(readr)
weber2014 <- read_csv("weber2014_ac-ft.csv")
#View(weber2014)
#add on climate data######################################  
library(tidyverse)
library(readxl)
ClimateFlowsWeberRiver <- read_excel("ClimateFlowsWeberRiver.xlsx")
#View(ClimateFlowsWeberRiver)

ClimateFlowsWeberRiver <- ClimateFlowsWeberRiver[4:351,1:6]
data <- as_tibble(ClimateFlowsWeberRiver)
SumsofClimate <- c(1:29)

#Convert monthly climate data to annual data
i=1
j=1
k=2
while (k<=6) {
  while (i<=348) {
    SumsofClimate[j] <- sum(data[i:(i+11),k])  
    i=i+12
    j=j+1
  }
  i=1
  k=k+1
}

#Add data
weber2014 <- add_row(weber2014, X1 = 592:736,col_name = 'weber2014' ,year = 2020:2164, month = 1:1, recon_m3s = SumsofClimate, resolution = "annual" )
weber2014[577:591,8] <- weber2014[577:591,7]

#average specified yearly increments######################  
#Weber_Annualflow <- weber2014$recon_m3s  #with climate data

#with no climate data
weber2014 <- read_csv("weber2014_ac-ft.csv")
weber2014[577:591,8] <- weber2014[577:591,7]
Weber_Annualflow <- weber2014$recon_m3s 
#-Iteration-----------------------------------------------------------------
num_years <- 591
y=1
acft<-c(1:num_years)
acft <- data.frame(acft)
while (y<=60) {
  i=1
  L=y-1
  
  while (i<=num_years) {
    acft[i,y] <- mean(Weber_Annualflow[i:(i+L)])
    i=i+1
  }
  data.frame(acft)
  y=y+1  
}

#view(acft)
#-Rename colums-----------------------------------------------------------

names(acft) <- gsub("V","Length of Years ",names(acft))
names(acft) <- sub("acft","Length of Years 1",names(acft))

#-Insert Years-------------------------------------------------------------

acft$years <- weber2014$year

#-PLOTS#--------------------------------------------------------------------
library("plotly", lib.loc="~/R/win-library/3.5")

#boxplots
pb <- plot_ly(acft, y = acft$`Length of Years 1`,x=1, type = "box",name='1 Year') %>%
  #add_trace(y=acft$`Length of Years 2`, x=2,name='2 Year')%>%
  #add_trace(y=acft$`Length of Years 3`, x=3,name='3 Year')%>%
  #add_trace(y=acft$`Length of Years 4`, x=4,name='4 Year')%>%
  add_trace(y=acft$`Length of Years 5`, x=5,name='5 Year')%>%
  #add_trace(y=acft$`Length of Years 6`, x=6,name='6 Year')%>%
  #add_trace(y=acft$`Length of Years 7`, x=7,name='7 Year')%>%
  #add_trace(y=acft$`Length of Years 8`, x=8,name='8 Year')%>%
  #add_trace(y=acft$`Length of Years 9`, x=9,name='9 Year')%>%
  add_trace(y=acft$`Length of Years 10`, x=10,name='10 Year')%>%
  add_trace(y=acft$`Length of Years 15`, x=15,name='15 Year')%>%
  add_trace(y=acft$`Length of Years 20`, x=20,name='20 Year')%>%
  add_trace(y=acft$`Length of Years 25`, x=25,name='25 Year')%>%
  add_trace(y=acft$`Length of Years 30`, x=30,name='30 Year')%>%
  add_trace(y=acft$`Length of Years 35`, x=35,name='35 Year')%>%
  add_trace(y=acft$`Length of Years 40`, x=40,name='40 Year')%>%
  add_trace(y=acft$`Length of Years 45`, x=45,name='45 Year')%>%
  add_trace(y=acft$`Length of Years 50`, x=50,name='50 Year')%>%
  add_trace(y=acft$`Length of Years 55`, x=55,name='55 Year')%>%
  add_trace(y=acft$`Length of Years 60`, x=60,name='60 Year')%>%
  layout(title='Forward Looking_Linear Average Annual Flow')
  
pb

#scatterplots----
    #Data Labels on Hover this link: https://plot.ly/r/line-and-scatter/
ps <- plot_ly(acft, y = acft$`Length of Years 1`,x = 1, type ="scatter",
  name = "1 Year Average Annual", text = ~paste("Year:",acft$years) )%>%             
  #add_trace(y=acft$`Length of Years 2`, x=2, name = "2 Year Average Annual")%>%
  #add_trace(y=acft$`Length of Years 3`, x=3, name = "3 Year Average Annual")%>%
  #add_trace(y=acft$`Length of Years 4`, x=4, name = "4 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 5`, x=5, name = "5 Year Average Annual")%>%
  #add_trace(y=acft$`Length of Years 6`, x=6, name = "6 Year Average Annual")%>%
  #add_trace(y=acft$`Length of Years 7`, x=7, name = "7 Year Average Annual")%>%
  #add_trace(y=acft$`Length of Years 8`, x=8, name = "8 Year Average Annual")%>%
  #add_trace(y=acft$`Length of Years 9`, x=9, name = "9 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 10`, x=10, name = "10 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 15`, x=15, name = "15 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 20`, x=20, name = "20 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 25`, x=25, name = "25 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 30`, x=30, name = "30 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 35`, x=35, name = "35 Year Average Annual") %>%
  add_trace(y=acft$`Length of Years 40`, x=40, name = "40 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 45`, x=45, name = "45 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 50`, x=50, name = "50 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 55`, x=55, name = "55 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 60`, x=60, name = "60 Year Average Annual")%>%
layout(title = 'Forward Looking_Linear Average Annual Flow')
ps


ps <- plot_ly(acft, y = acft$`Length of Years 1`,x = '1 Year',color = acft$years ,type = "scatter",name='1 Year Annual Average')%>%
  #add_trace(y=acft$`Length of Years 2`, x='2 Year')%>%
  #add_trace(y=acft$`Length of Years 3`, x='3 Year')%>%
  #add_trace(y=acft$`Length of Years 4`, x='4 Year')%>%
  #add_trace(y=acft$`Length of Years 5`, x='5 Year')%>%
  #add_trace(y=acft$`Length of Years 6`, x='6 Year')%>%
  #add_trace(y=acft$`Length of Years 7`, x='7 Year')%>%
  #add_trace(y=acft$`Length of Years 8`, x='8 Year')%>%
  #add_trace(y=acft$`Length of Years 9`, x='9 Year')%>%
  add_trace(y=acft$`Length of Years 10`, x='10 Year',name='10 Year Annual Average')%>%
  #add_trace(y=acft$`Length of Years 11`, x='11 Year')%>%
  #add_trace(y=acft$`Length of Years 12`, x='12 Year')%>%
  #add_trace(y=acft$`Length of Years 13`, x='13 Year')%>%
  #add_trace(y=acft$`Length of Years 14`, x='14 Year')%>%
  #add_trace(y=acft$`Length of Years 15`, x='15 Year')%>%
  #add_trace(y=acft$`Length of Years 16`, x='16 Year')%>%
  #add_trace(y=acft$`Length of Years 17`, x='17 Year')%>%
  #add_trace(y=acft$`Length of Years 18`, x='18 Year')%>%
  #add_trace(y=acft$`Length of Years 19`, x='19 Year')%>%
  add_trace(y=acft$`Length of Years 20`, x='20 Year',name='20 Year Annual Average')%>%
  #add_trace(y=acft$`Length of Years 21`, x='21 Year')%>%
  #add_trace(y=acft$`Length of Years 22`, x='22 Year')%>%
  #add_trace(y=acft$`Length of Years 23`, x='23 Year')%>%
  #add_trace(y=acft$`Length of Years 24`, x='24 Year')%>%
  #add_trace(y=acft$`Length of Years 25`, x='25 Year')%>%
  #add_trace(y=acft$`Length of Years 26`, x='26 Year')%>%
  #add_trace(y=acft$`Length of Years 27`, x='27 Year')%>%
  #add_trace(y=acft$`Length of Years 28`, x='28 Year')%>%
  #add_trace(y=acft$`Length of Years 29`, x='29 Year')%>%
  add_trace(y=acft$`Length of Years 30`, x='30 Year',name='30 Year Annual Average')%>%
  #add_trace(y=acft$`Length of Years 31`, x='31 Year')%>%
  #add_trace(y=acft$`Length of Years 32`, x='32 Year')%>%
  #add_trace(y=acft$`Length of Years 33`, x='33 Year')%>%
  #add_trace(y=acft$`Length of Years 34`, x='34 Year')%>%
  #add_trace(y=acft$`Length of Years 35`, x='35 Year')%>%
  add_trace(y=acft$`Length of Years 40`, x='40 Year',name='40 Year Annual Average')%>%
  layout(title = 'Forward Looking_Linear Average Annual Flow')
  ps

  ps <- plot_ly(acft, y = acft$`Length of Years 1`,x = '1 Year',color = acft$years ,type = "scatter")%>%
    add_trace(y=acft$`Length of Years 2`, x=2)%>%
    add_trace(y=acft$`Length of Years 3`, x=3)%>%
    add_trace(y=acft$`Length of Years 4`, x=4)%>%
    add_trace(y=acft$`Length of Years 5`, x=5)%>%
    add_trace(y=acft$`Length of Years 6`, x=6)%>%
    add_trace(y=acft$`Length of Years 7`, x=7)%>%
    add_trace(y=acft$`Length of Years 8`, x=8)%>%
    add_trace(y=acft$`Length of Years 9`, x=9)%>%
    add_trace(y=acft$`Length of Years 10`, x=10)%>%
    add_trace(y=acft$`Length of Years 15`, x=11)%>%
    add_trace(y=acft$`Length of Years 20`, x=12)%>%
    add_trace(y=acft$`Length of Years 25`, x=13)%>%
    add_trace(y=acft$`Length of Years 30`, x=14)%>%
    add_trace(y=acft$`Length of Years 35`, x=15)%>%
    add_trace(y=acft$`Length of Years 40`, x=16)%>%
    add_trace(y=acft$`Length of Years 45`, x=17)%>%
    add_trace(y=acft$`Length of Years 50`, x=18)%>%
    add_trace(y=acft$`Length of Years 55`, x=19)%>%
    add_trace(y=acft$`Length of Years 60`, x=20)%>%
    add_trace(y=acft$`Length of Years 40`, x=21)%>%
    add_trace(y=acft$`Length of Years 45`, x=22)%>%
    add_trace(y=acft$`Length of Years 50`, x=23)%>%
    add_trace(y=acft$`Length of Years 55`, x=24)%>%
    add_trace(y=acft$`Length of Years 60`, x=25)%>%
    add_trace(y=acft$`Length of Years 40`, x=26)%>%
    add_trace(y=acft$`Length of Years 45`, x=27)%>%
    add_trace(y=acft$`Length of Years 50`, x=28)%>%
    add_trace(y=acft$`Length of Years 55`, x=29)%>%
    add_trace(y=acft$`Length of Years 60`, x=30)%>%
    add_trace(y=acft$`Length of Years 40`, x=31)%>%
    add_trace(y=acft$`Length of Years 45`, x=32)%>%
    add_trace(y=acft$`Length of Years 50`, x=33)%>%
    add_trace(y=acft$`Length of Years 55`, x=34)%>%
    add_trace(y=acft$`Length of Years 60`, x='35 Year')%>%
    layout(title = 'Forward Looking_Linear Average Annual Flow')
  ps

  view(acft)
  
#Imporant years 1 10 20 30 and 40-----------
   acft_import <- acft$years
   acft_import <- data.frame(acft_import)
   acft_import$`Lengths of Years 1` <-acft$`Length of Years 1`
   acft_import$`Lengths of Years 10` <-acft$`Length of Years 10`
   acft_import$`Lengths of Years 20` <-acft$`Length of Years 20`
   acft_import$`Lengths of Years 30` <-acft$`Length of Years 30`
   acft_import$`Lengths of Years 40` <-acft$`Length of Years 40`
   acft_import$`Lengths of Years 50` <-acft$`Length of Years 50`
   acft_import$`Lengths of Years 60` <-acft$`Length of Years 60`
   
   names(acft_import) <- sub("acft_import","years",names(acft_import))   
  #view(acft_import) 
     
  
#Plot every 10 yrs by year 
   y = list(title ="Annual Average Flow (Acre-Feet/Year)")
   x= list(title = "Year")

  ps <- plot_ly(acft_import,y= acft_import$`Lengths of Years 1`,x=acft_import$years,type = 'scatter',name = '1 Year Annual Average',mode='line')%>%
    add_trace(y=acft_import$`Lengths of Years 10`,x=acft_import$years,name = '10 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 20`,x=acft_import$years,name = '20 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 30`,x=acft_import$years,name = '30 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 40`,x=acft_import$years,name = '40 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 50`,x=acft_import$years,name = '50 Year Annaul Average')%>%
    add_trace(y=acft_import$`Lengths of Years 60`,x=acft_import$years,name = '60 Year Annaul Average')%>%
        layout(title='Annual Averages')

  ps  
  
  ps <- plot_ly(acft,y= acft$`Length of Years 25`,x=acft$years,type = 'scatter',name = '25 Year Annual Average',mode='line')%>%
    add_trace(y=acft$`Length of Years 30`,x=acft$years,name = '30 Year Annual Average')%>%
    add_trace(y=acft$`Length of Years 35`,x=acft$years,name = '35 Year Annual Average')%>%
    #add_trace(y=acft_import$`Lengths of Years 10`,x=acft_import$years,name = '10 Year Annual Average')%>%
    layout(title='Annual Averages',yaxis =y,xaxis = x)
  
  ps 
  
  
  ps <- plot_ly(acft_import,y= acft_import$`Lengths of Years 10`,x=acft_import$years,type = 'pointcloud',name = '10 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 20`,x=acft_import$years,name = '20 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 30`,x=acft_import$years,name = '30 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 40`,x=acft_import$years,name = '40 Year Annual Average')%>%
    layout(title='Annual Averages')
  ps
  
#Histograms---------------------------------------------------------------------------------------------------------------------------------------
  #Histogram #Think about developing more histograms #What type is the question? What can they show us?
  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 10`,x=acft_import$years,type = 'histogram',name = '10 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 20`,x=acft_import$years,name = '20 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 30`,x=acft_import$years,name = '30 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 40`,x=acft_import$years,name = '40 Year Annual Average')%>%
    layout(title='Annual Averages')
  
  ph  
  setwd("~/")
  ph2 <- plot_ly(acft_import,y= acft_import$`Lengths of Years 10`,x=acft_import$years,type = 'histogram2d',name = '10 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 20`,x=acft_import$years,name = '20 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 30`,x=acft_import$years,name = '30 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 40`,x=acft_import$years,name = '40 Year Annual Average')%>%
    layout(title='Annual Averages')
  
  ph2  
  
  #Contour Histogram
  ph3 <- plot_ly(acft_import,y= acft_import$`Lengths of Years 1`,x=acft_import$years,type = 'histogram2dcontour',name = '1 Year Annual Average')%>%
    layout(title='1 Year Annual Averages')
  ph3
  
  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 10`,x=acft_import$years,type = 'histogram2dcontour',name = '10 Year Annual Average')%>%
    layout(title='10 Year Annual Averages')
  ph
  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 20`,x=acft_import$years,type = 'histogram2dcontour',name = '20 Year Annual Average')%>%
    layout(title='20 Year Annual Averages')
  ph
  
  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 30`,x=acft_import$years,type = 'histogram2dcontour',name = '30 Year Annual Average')%>%
    layout(title='30 Year Annual Averages')
  ph
  
  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 40`,x=acft_import$years,type = 'histogram2dcontour',name = '40 Year Annual Average')%>%
    layout(title='40 Year Annual Averages')
  ph
  
  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 50`,x=acft_import$years,type = 'histogram2dcontour',name = '50 Year Annual Average')%>%
    layout(title='50 Year Annual Averages')
  ph
  
  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 60`,x=acft_import$years,type = 'histogram2dcontour',name = '60 Year Annual Average')%>%
    layout(title='60 Year Annual Averages')
  ph
  
  
#-3D Scatter------------------------------------------------------------------------------------------------------------------------------------------------------  
 
   ps3 <- plot_ly(acft_import,z = 30,y= acft_import$`Lengths of Years 30`,x=acft_import$years,type = 'scatter3d',name = '30 Year Annual Average')%>%
    add_trace(z=10,y=acft_import$`Lengths of Years 10`,x=acft_import$years, name = '10 YearAnnual Average' )%>%
    layout(title='Annual Averages',yaxis =y, xaxis =x)
  
  ps3 
  
#-----------------------------------------------------------------------------------------------
    
  ps <- plot_ly(acft_import,y= acft_import$`Lengths of Years 10`,x=acft_import$years,type = 'pointcloud',name = '10 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 20`,x=acft_import$years,name = '20 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 30`,x=acft_import$years,name = '30 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 40`,x=acft_import$years,name = '40 Year Annual Average')%>%
    layout(title='Annual Averages')
  ps
  
  
  #Sort Data -------------------------------------------------------------
  Data <-sort(acft_import$`Lengths of Years 1`) #What year for low values
  Data<-data.frame(Data)
  
  View(Data)
#-Save DATA----------------------------------------------------------------
#Save every 10 years data
  write.xlsx(acft_import,"Inflow_data_10yrs.xlsx") 
write.csv(acft_import,"Inflow_data_10yrs.csv")  
