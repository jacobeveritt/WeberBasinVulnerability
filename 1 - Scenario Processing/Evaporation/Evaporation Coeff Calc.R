#Evaporation Coeffs

### Clear any existing data or functions.
rm(list=ls())
#Input Existing Model Evaporation Coeffs
library(readxl)
Existing_Model_Evap_Coeffs <- read_excel("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/2 - RiverWare Modeling/Hydrology/Existing Model Evap Coeffs.xlsx")
Existing_Model_Evap_Coeffs <- data.frame(Existing_Model_Evap_Coeffs)
#View(Existing_Model_Evap_Coeffs)
setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Evaporation")

#Input New Evaporation Coeffs -- Adjusted Evap and Precip from University study of Willard Bay
  library(readr)
  hist_adjusted <- read_csv("hist_adjusted.csv")
  #View(hist_adjusted)
  late_adjusted <- read_csv("late_adjusted.csv")
  #View(late_adjusted)
  mid_adjusted <- read_csv("mid_adjusted.csv")
#View(mid_adjusted)
  #Dataframes
    hist_adjusted <- data.frame(hist_adjusted)
    late_adjusted <- data.frame(late_adjusted)
    mid_adjusted <- data.frame(mid_adjusted)
#Convert Adjusted data from UofU from mm to ft
    hist_adjusted[,2:3]<- hist_adjusted[,2:3]*0.00328084
    late_adjusted[,2:3]<- late_adjusted[,2:3]*0.00328084
    mid_adjusted[,2:3]<- mid_adjusted[,2:3]*0.00328084
#rename columns
    names(hist_adjusted)[2]<-paste("precipitation (ft)")
    names(hist_adjusted)[3]<-paste("evaporation (ft)")
    names(late_adjusted)[2]<-paste("precipitation (ft)")
    names(late_adjusted)[3]<-paste("evaporation (ft)")
    names(mid_adjusted)[2]<-paste("precipitation (ft)")
    names(mid_adjusted)[3]<-paste("evaporation (ft)")
  #View(hist_adjusted)

### Calculate New Evaporation Coeffs
# Old * (new willard/old willard) or Existing * (Adjusted/Existing)

   ##Hist_Adjusted
    hist_adjusted_model_evap_coeffs <- Existing_Model_Evap_Coeffs  #create the correct structure for new dataframe
i=2
while (i<=18) {
  hist_adjusted_model_evap_coeffs[,i] <- as.numeric(Existing_Model_Evap_Coeffs[,i]) * (hist_adjusted[,3]/as.numeric(Existing_Model_Evap_Coeffs[,18]))
  i=i+2
}
#View(hist_adjusted_model_evap_coeffs)
#Change NAN values to 0
j=2
while (j<=18) {
  i=1
  while (i<=13) {
    hist_adjusted_model_evap_coeffs[i,j] <- ifelse(hist_adjusted_model_evap_coeffs[i,j]== "NaN",0,hist_adjusted_model_evap_coeffs[i,j])
    i=i+1
  }
  j=j+2
}
#View(hist_adjusted_model_evap_coeffs)

    ##Late_adjusted
late_adjusted_model_evap_coeffs <- Existing_Model_Evap_Coeffs
i=2
while (i<=18) {
  late_adjusted_model_evap_coeffs[,i] <- as.numeric(Existing_Model_Evap_Coeffs[,i]) * (late_adjusted[,3]/as.numeric(Existing_Model_Evap_Coeffs[,18]))
  i=i+2
}
#Change NAN values to 0
j=2
while (j<=18) {
  i=1
  while (i<=13) {
    late_adjusted_model_evap_coeffs[i,j] <- ifelse(late_adjusted_model_evap_coeffs[i,j]== "NaN",0,late_adjusted_model_evap_coeffs[i,j])
    i=i+1
  }
  j=j+2
}
#View(late_adjusted_model_evap_coeffs)

  ##Mid_adjusted
mid_adjusted_model_evap_coeffs <- Existing_Model_Evap_Coeffs
i=2
while (i<=18) {
  mid_adjusted_model_evap_coeffs[,i] <- as.numeric(Existing_Model_Evap_Coeffs[,i]) * (mid_adjusted[,3]/as.numeric(Existing_Model_Evap_Coeffs[,18]))
  i=i+2
}
#Change NAN values to 0
j=2
while (j<=18) {
  i=1
  while (i<=13) {
    mid_adjusted_model_evap_coeffs[i,j] <- ifelse(mid_adjusted_model_evap_coeffs[i,j]== "NaN",0,mid_adjusted_model_evap_coeffs[i,j])
    i=i+1
  }
  j=j+2
}
#View(mid_adjusted_model_evap_coeffs)

#Output Evap Files to RiverWare/RiverSmart
setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/2 - RiverWare Modeling/Hydrology")

library(openxlsx)

write.xlsx(hist_adjusted_model_evap_coeffs, 'Evap_Hist2.xlsx', sheetName="Run0",
           col.names=TRUE, row.names=TRUE, append=FALSE, showNA=TRUE, password=NULL)
write.xlsx(late_adjusted_model_evap_coeffs, 'Evap_Late2.xlsx', sheetName="Run0",
           col.names=TRUE, row.names=TRUE, append=FALSE, showNA=TRUE, password=NULL)
write.xlsx(mid_adjusted_model_evap_coeffs, 'Evap_Mid2.xlsx', sheetName="Run0",
           col.names=TRUE, row.names=TRUE, append=FALSE, showNA=TRUE, password=NULL)

## Due to RiverWare issues copy values from xlsx files outputted from this code and copy into xlsx files with no number 2
  #for example  Evap_Hist2.xlsx values only copied into Evap_Hist.xlsx keeping the format of the columns the same.

##### End of Evaporation Code, Now Precipitation ############


### New Precipitation Coeffs for Willard Bay

#Find Required file formatin to input files through RiverWare DMI.

##Hist_Adjusted
hist_adjusted_model_precip_coeffs <- hist_adjusted[,2]  #create the correct structure for new dataframe
  #repeat for the 30 year period
hist_adjusted_model_precip_coeffs[1:360] <- rep(hist_adjusted[,2])
  View(hist_adjusted_model_precip_coeffs)

##Late_adjusted
late_adjusted_model_precip_coeffs <- late_adjusted[,2]
  #repeat for the 30 year period
late_adjusted_model_precip_coeffs[1:360] <- rep(hist_adjusted[,2])
  #View(late_adjusted_model_precip_coeffs)

##Mid_adjusted
mid_adjusted_model_precip_coeffs <- mid_adjusted[,2]
  #repeat for the 30 year period
mid_adjusted_model_precip_coeffs[1:360] <- rep(mid_adjusted[,2])
  View(mid_adjusted_model_precip_coeffs)

#Output Evap Files to RiverWare/RiverSmart
setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/2 - RiverWare Modeling/Hydrology")

library(openxlsx)

write.xlsx(hist_adjusted_model_precip_coeffs, 'Precip_Hist2.xlsx', sheetName="Run0",
           col.names=TRUE, row.names=TRUE, append=FALSE, showNA=TRUE, password=NULL)
write.xlsx(late_adjusted_model_precip_coeffs, 'Precip_Late2.xlsx', sheetName="Run0",
           col.names=TRUE, row.names=TRUE, append=FALSE, showNA=TRUE, password=NULL)
write.xlsx(mid_adjusted_model_precip_coeffs, 'Precip_Mid2.xlsx', sheetName="Run0",
           col.names=TRUE, row.names=TRUE, append=FALSE, showNA=TRUE, password=NULL)

## Due to RiverWare issues copy values from xlsx files outputted from this code and copy into xlsx files with no number 2
#for example  Evap_Hist2.xlsx values only copied into Evap_Hist.xlsx keeping the format of the columns the same.
