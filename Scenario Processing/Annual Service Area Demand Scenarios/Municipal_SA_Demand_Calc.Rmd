---
title: "Weber Basin Conservancy District Projected Demands"
output: html_notebook
---


```{r}
#SA Divided County Demands Code
# *------------------------------------------------------------------
# | PROGRAM NAME: Service Area Divided Annual Demands
# | FILE NAME: SAdividedCounty_Demands
# | DATE: 3/11/18
# | CREATED BY:  Jacob Everitt         
# *----------------------------------------------------------------
# | PURPOSE:  Develop Approximate Demand Range Outputs for the Weber 
# |Conservancy District, using a series of scenario options, using 
# |2013 WBWCD report for projected data.(See"Scenarios_DemandNotations")
# |
# |
# *------------------------------------------------------------------
# | STEPS:               
# |  0:  For Counties
# |  1:  Input data, Manually Written in Code
# |  2:  Input Scenario Specification
# |  3:  Create a new Data Frame
# |  4:  Assign Population values to Notation
# |  5:  Calculate Per-Capita Outdoor Usage in GPCD
# |  6:  Calculate Per-Capita Indoor Usage in GPCD
# |  7:  Calculate Net Evap GPCD
# |  8:  Convert all GPCD units to Acre-Feet/year
# |  9:  Sum all Usage 
# |  10: Sum With Agricultural Demand to find Total Demand. 
# |
# |*------------------------------------------------------------------.
# | DATA USED:           
# |
# |https://water.utah.gov/2015WaterData.pdf, December 21, 2018.
# |
# |https://water.utah.gov/OtherReports/MUNICIPAL%20AND%20INDUSTRIAL%20WATER%20USE%20in%20UTAH.pdf, December 21, 2018.
# |
# |https://conservewater.utah.gov/pdf/SamplePlans/WBWCD2013.pdf, December 21, 2018.
# |
# |https://weberbasin.com/, December 21, 2018

# |*------------------------------------------------------------------
# | CONTENTS:               
# |  Part 0: Excel File #WBCDDemand_Workbook_County <- read_excel("WBCDDemand-Workbook_County.xlsx")
# |  PART 1:  
# |  PART 2: 
# |  PART 3: 
# *-----------------------------------------------------------------
# | UPDATES:               
# |
# |
# *------------------------------------------------------------------

#Set Working Directory
setwd("~/GitHub/WBCD_SA_DemandCalc_Jacob/Input_Data")

### Clear any existing data or functions.
rm(list=ls())

##Possible package installation necessary
#install.packages("RColorBrewer")
#install.packages("plotly")
#install.packages("readxl")
library(readxl)
library(plotly)
library(RColorBrewer)

##Input Data##  
  
  #Problems Loading Input Data, Have to individually Import each Dataset by clicking on the files. 


#DWRSA_Table <- read_excel("Division of Water Resources Service Area Table.xlsx")

DWRSA_Table <- read_excel("DWRSA_Table.xlsx")

## Municipal and Industrial water INPUTS 
      # 1- County Per Capita Usage
      # 2- County Populations 2015, 2070, 2150
      # 3- County Evapotranspiration
      # 4- Scenarios Input  
          #a)Indoor Municipal Per Capita: Same, Reduced, Drastically Reduced
          #b)Outdoor Municipal Per Capita: Same, Reduced, Drastically Reduced
          #c)
      # 5- Agricultural Inputs

#1 & #2 Inputs By County and Year

##Upload Prob. Cont.
  #Click on Each File then run code in Console not Source.

D2015<-read.csv("2015Data")
D2070<-read.csv("2070Data")
D2150<-read.csv("2150Data")
    

#3 GIS Inputs


#4 Scenarios Input

##Upload Probs

ScenarioSA_PCntChanges <- read_excel("PercentChanges.xlsx")

#5 GIS Inputs

#NOTE!!!
##### Possibly Create a Excel Sheet for All Input data ####

```

  *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

*Ctrl+Shift+K* to preview the HTML file

Demands by County
```{r}
## Current PerCapita Calculations

#Set initial values
i=1

CountyDemand <- data.frame(Utah= c(rep(NA)),Box_Elder = c(rep(NA)),Davis = c(rep(NA)), Morgan = c(rep(NA)),Summit = c(rep(NA)), Weber= c(rep(NA)),Dates = c(2015,2070,2150))

#Calcs

#2015
while (i<=6) {
CountyDemand[1,i] <- D2015[i,3]*D2015[i,4] +D2015[i,3]*D2015[i,5]
i=i+1}

#2070
i=1
while (i<=6) {
CountyDemand[2,i] <- D2070[i,3]*D2070[i,4] +D2070[i,3]*D2070[i,5]
i=i+1}

#2150
i=1
while (i<=6) {
CountyDemand[3,i] <- D2150[i,3]*D2150[i,4] +D2150[i,3]*D2150[i,5]
i=i+1}

CountyDemand


#Conversion

CountyDemand <- CountyDemand*0.0000030688832459704*365

CountyDemand[1:3,7]<-c(2015,2070,2150)

CountyDemand

##Base Utah County Values

CountyDemand[1:3,1] <- c(rep(35500))
CountyDemand

#Input Calculated Total County Demand 

DWRSA_Table$Counties <- c(CountyDemand[1,1],CountyDemand[1,5],CountyDemand[1,5],CountyDemand[1,4],CountyDemand[1,4],CountyDemand[1,4],CountyDemand[1,5],CountyDemand[1,4],CountyDemand[1,4],CountyDemand[1,3],CountyDemand[1,3],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6])


# Create a New Dataframe

CountyDemand_SA <- data.frame('2015' = c(1:19),'2070' = c(1:19),'2150' = c(1:19))

# Calculate

##vlookup
#2015

i=1
while (i<=19) {
CountyDemand_SA[i,1] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
i=i+1
}

#2070
i=1
year=2

DWRSA_Table$Counties <- c(CountyDemand[year,1],CountyDemand[year,5],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,3],CountyDemand[year,3],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6])

while (i<=19) {
CountyDemand_SA[i,2] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
i=i+1
}

#2150
year=3
i=1

DWRSA_Table$Counties <- c(CountyDemand[year,1],CountyDemand[year,5],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,3],CountyDemand[year,3],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6])

while (i<=19) {
CountyDemand_SA[i,3] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
i=i+1
}

#View(CountyDemand_SA)

```

Demands by Service Area 
```{r}

#Service Area

#DWRSA_Table <- read.csv("GitHub/Weber_Conservancy_District_Demand_Jacob/Total_Demands/Division of Water Resources Service Area Table.csv")


DWRSA_Table$Counties <- c(CountyDemand[1,1],CountyDemand[1,5],CountyDemand[1,5],CountyDemand[1,4],CountyDemand[1,4],CountyDemand[1,4],CountyDemand[1,5],CountyDemand[1,4],CountyDemand[1,4],CountyDemand[1,3],CountyDemand[1,3],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6])

CountyDemand_SA <- data.frame('2015' = c(1:19),'2070' = c(1:19),'2150' = c(1:19))

#vlookup
#2015
i=1
while (i<=19) {
CountyDemand_SA[i,1] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
i=i+1
}

#2070
i=1
year=2

DWRSA_Table$Counties <- c(CountyDemand[year,1],CountyDemand[year,5],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,3],CountyDemand[year,3],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6])

while (i<=19) {
CountyDemand_SA[i,2] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
i=i+1
}

#2150
year=3
i=1

DWRSA_Table$Counties <- c(CountyDemand[year,1],CountyDemand[year,5],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,3],CountyDemand[year,3],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6])

while (i<=19) {
CountyDemand_SA[i,3] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
i=i+1
}



```

```{r}
#With Percent Changes (Decrease Scenario)
#Change The Input by ScenarioSA_PcntChanges

#Decrease the Potable Use by 10%  
#SC = Scenario Column (e.i. Same, Decrease, Increase, Drastic Decrease, Drastic Increase) 

SC = 4 # Decrease

  #2015
  i=2
  while (i<=6) {D2015[i,4]<-D2015[i,4]-(D2015[i,4]*ScenarioSA_PCntChanges[1,SC])
  i=i+1
  }

  #2070
  i=2
  while (i<=6) {D2070[i,4]<-D2070[i,4]-(D2070[i,4]*ScenarioSA_PCntChanges[1,SC])
  i=i+1
  }

  #2150
  i=2
  while (i<=6) {D2150[i,4]<-D2150[i,4]-(D2150[i,4]*ScenarioSA_PCntChanges[1,SC])
  i=i+1
  }

#Decrease the Secondary Use by 34% to make total PerCapita reduction 25%
  #2015
  i=2
  while (i<=6) {D2015[i,5]<-D2015[i,5]-(D2015[i,5]*ScenarioSA_PCntChanges[2,SC])
  i=i+1
  }

  #2070
  i=2
  while (i<=6) {D2070[i,5]<-D2070[i,5]-(D2070[i,5]*ScenarioSA_PCntChanges[2,SC])
  i=i+1
  }

  #2150
  i=2
  while (i<=6) {D2150[i,5]<-D2150[i,5]-(D2150[i,5]*ScenarioSA_PCntChanges[2,SC])
  i=i+1
  }


## Calculations

#Set initial values
i=1

CountyDemand <- data.frame(Utah= c(rep(NA)),Box_Elder = c(rep(NA)),Davis = c(rep(NA)), Morgan = c(rep(NA)),Summit = c(rep(NA)), Weber= c(rep(NA)),Dates = c(2015,2070,2150))

#Calcs

#2015
while (i<=6) {
CountyDemand[1,i] <- D2015[i,3]*D2015[i,4] +D2015[i,3]*D2015[i,5]
i=i+1}

#2070
i=1
while (i<=6) {
CountyDemand[2,i] <- D2070[i,3]*D2070[i,4] +D2070[i,3]*D2070[i,5]
i=i+1}

#2150
i=1
while (i<=6) {
CountyDemand[3,i] <- D2150[i,3]*D2150[i,4] +D2150[i,3]*D2150[i,5]
i=i+1}

CountyDemand


#Conversion

CountyDemand <- CountyDemand*0.0000030688832459704*365

CountyDemand[1:3,7]<-c(2015,2070,2150)

CountyDemand

##Base Utah County Values

CountyDemand[1:3,1] <- c(rep(35500))
CountyDemand


#Service Area
library(readxl)
#DWRSA_Table <- read_excel("GitHub/Weber_Conservancy_District_Demand_Jacob/Total_Demands/Division of Water Resources Service Area Table.xlsx")

#DWRSA_Table <- read.csv("GitHub/Weber_Conservancy_District_Demand_Jacob/Total_Demands/Division of Water Resources Service Area Table.csv")


DWRSA_Table$Counties <- c(CountyDemand[1,1],CountyDemand[1,5],CountyDemand[1,5],CountyDemand[1,4],CountyDemand[1,4],CountyDemand[1,4],CountyDemand[1,5],CountyDemand[1,4],CountyDemand[1,4],CountyDemand[1,3],CountyDemand[1,3],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6])

CountyDemand_SA_Decrease <- data.frame('2015' = c(1:19),'2070' = c(1:19),'2150' = c(1:19))

##vlookup
#2015
i=1
while (i<=19) {
CountyDemand_SA_Decrease[i,1] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
i=i+1
}

#2070
i=1
year=2

DWRSA_Table$Counties <- c(CountyDemand[year,1],CountyDemand[year,5],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,3],CountyDemand[year,3],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6])

while (i<=19) {
CountyDemand_SA_Decrease[i,2] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
i=i+1
}

#2150
year=3
i=1

DWRSA_Table$Counties <- c(CountyDemand[year,1],CountyDemand[year,5],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,3],CountyDemand[year,3],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6])

while (i<=19) {
CountyDemand_SA_Decrease[i,3] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
i=i+1
}

CountyDemand_SA_Decrease



```

```{r}
#With Percent Changes  (Drastic Decrease (DD))
#Change The Input by ScenarioSA_PcntChanges

#Reset Values
#1 & #2 Inputs By County and Year

D2015<-read.csv("2015Data")
D2070<-read.csv("2070Data")
D2150<-read.csv("2150Data")

#SC = Scenario Column (e.i. Same, Decrease, Increase, Drastic Decrease, Drastic Increase) 

SC = 6 #Drastic Decrease

#Decrease the Potable Use by 20%  

  #2015
  i=2
  while (i<=6) {D2015[i,4]<-D2015[i,4]-(D2015[i,4]*ScenarioSA_PCntChanges[1,SC])
  i=i+1
  }

  #2070
  i=2
  while (i<=6) {D2070[i,4]<-D2070[i,4]-(D2070[i,4]*ScenarioSA_PCntChanges[1,SC])
  i=i+1
  }

  #2150
  i=2
  while (i<=6) {D2150[i,4]<-D2150[i,4]-(D2150[i,4]*ScenarioSA_PCntChanges[1,SC])
  i=i+1
  }

#Decrease the Secondary Use by 44% ???
  #2015
  i=2
  while (i<=6) {D2015[i,5]<-D2015[i,5]-(D2015[i,5]*ScenarioSA_PCntChanges[2,SC])
  i=i+1
  }

  #2070
  i=2
  while (i<=6) {D2070[i,5]<-D2070[i,5]-(D2070[i,5]*ScenarioSA_PCntChanges[2,SC])
  i=i+1
  }

  #2150
  i=2
  while (i<=6) {D2150[i,5]<-D2150[i,5]-(D2150[i,5]*ScenarioSA_PCntChanges[2,SC])
  i=i+1
  }

## Calculations

#Set initial values
i=1

CountyDemand <- data.frame(Utah= c(rep(NA)),Box_Elder = c(rep(NA)),Davis = c(rep(NA)), Morgan = c(rep(NA)),Summit = c(rep(NA)), Weber= c(rep(NA)),Dates = c(2015,2070,2150))

#Calcs

#2015
while (i<=6) {
CountyDemand[1,i] <- D2015[i,3]*D2015[i,4] +D2015[i,3]*D2015[i,5]
i=i+1}

#2070
i=1
while (i<=6) {
CountyDemand[2,i] <- D2070[i,3]*D2070[i,4] +D2070[i,3]*D2070[i,5]
i=i+1}

#2150
i=1
while (i<=6) {
CountyDemand[3,i] <- D2150[i,3]*D2150[i,4] +D2150[i,3]*D2150[i,5]
i=i+1}

CountyDemand


#Conversion

CountyDemand <- CountyDemand*0.0000030688832459704*365

CountyDemand[1:3,7]<-c(2015,2070,2150)

CountyDemand

##Base Utah County Values

CountyDemand[1:3,1] <- c(rep(35500))
CountyDemand


#Service Area

#DWRSA_Table <- read_excel("GitHub/Weber_Conservancy_District_Demand_Jacob/Total_Demands/Division of Water Resources Service Area Table.xlsx")


DWRSA_Table$Counties <- c(CountyDemand[1,1],CountyDemand[1,5],CountyDemand[1,5],CountyDemand[1,4],CountyDemand[1,4],CountyDemand[1,4],CountyDemand[1,5],CountyDemand[1,4],CountyDemand[1,4],CountyDemand[1,3],CountyDemand[1,3],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6],CountyDemand[1,6])

CountyDemand_SA_DD <- data.frame('2015' = c(1:19),'2070' = c(1:19),'2150' = c(1:19))

##vlookup
#2015
i=1
while (i<=19) {
CountyDemand_SA_DD[i,1] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
i=i+1
}

#2070
i=1
year=2

DWRSA_Table$Counties <- c(CountyDemand[year,1],CountyDemand[year,5],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,3],CountyDemand[year,3],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6])

while (i<=19) {
CountyDemand_SA_DD[i,2] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
i=i+1
}

#2150
year=3
i=1

DWRSA_Table$Counties <- c(CountyDemand[year,1],CountyDemand[year,5],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,5],CountyDemand[year,4],CountyDemand[year,4],CountyDemand[year,3],CountyDemand[year,3],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6],CountyDemand[year,6])

while (i<=19) {
CountyDemand_SA_DD[i,3] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
i=i+1
}

View(CountyDemand_SA_DD)

```
Plots
```{r}
library("plotly")

#BarCharts

LabelSA = DWRSA_Table$Description

p <- plot_ly(data = CountyDemand_SA,type ="bar", x = LabelSA , y = CountyDemand_SA)
p

#Pie
library(plotly)

LabelSA = DWRSA_Table$Description

#plot_ly(data =CountyDemand_SA,labels = LabelSA, values=CountyDemand_SA$X2015 ,type = "pie",domain = list(x =c(0,1/3),y=c(0,1))) %>% add_trace(data =CountyDemand_SA ,labels = LabelSA, values=CountyDemand_SA$X2070,type = "pie",domain =list(x=c(1/3,2/3),y=c(0,1)))%>% add_trace(data =CountyDemand_SA ,labels = LabelSA, values=CountyDemand_SA$X2150,type = "pie",domain =list(x=c(2/3,1),y=c(0,1)))
  



```

```{r}
#BarCharts

LabelSA = DWRSA_Table$Description

plot_ly(data = CountyDemand_SA,type ="bar")


#Pie
library(plotly)

LabelSA = DWRSA_Table$Description

plot_ly(data =CountyDemand_SA,labels = LabelSA, values=CountyDemand_SA$X2015 ,type = "pie",domain = list(x =c(0,1/3),y=c(0,1))) %>%
  add_trace(data =CountyDemand_SA ,labels = LabelSA, values=CountyDemand_SA$X2070,type = "pie",domain =list(x=c(1/3,2/3),y=c(0,1)))%>%
  add_trace(data =CountyDemand_SA ,labels = LabelSA, values=CountyDemand_SA$X2150,type = "pie",domain =list(x=c(2/3,1),y=c(0,1)))
  


 ```
