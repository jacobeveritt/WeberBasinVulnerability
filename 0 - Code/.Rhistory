#2070
D2070$DDSecondary.Use_ET15 <- D2070$ET_15_Secondary.Use * DDSecondary
#2150
D2150$DDSecondary.Use_ET15 <- D2150$ET_15_Secondary.Use * DDSecondary
######Calculate Demand Drastic Decreased Values#################################################################################
#Calculate Demand by County For 2015, 2070 and 2150
#2015
D2015$MI_County_PCDD_ET15 <- ((D2015$Population*D2015$DDPotable.Use) + (D2015$Population*D2015$DDSecondary.Use_ET15))*GALtoAF
#2070
D2070$MI_County_PCDD_ET15 <- ((D2070$Population*D2070$DDPotable.Use) + (D2070$Population*D2070$DDSecondary.Use_ET15))*GALtoAF
#2150
D2150$MI_County_PCDD_ET15 <- ((D2150$Population*D2150$DDPotable.Use) + (D2150$Population*D2150$DDSecondary.Use_ET15))*GALtoAF
###Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table
#2015
D2015$MI_SA_PCDD_ET15 <- D2015$MI_County_PCDD_ET15*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)
#2070
D2070$MI_SA_PCDD_ET15 <- D2070$MI_County_PCDD_ET15*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)
#2150
D2150$MI_SA_PCDD_ET15 <- D2150$MI_County_PCDD_ET15*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)
#----------------------------------- ###ET Scenario c. Decrease to Usage due to ET (Decrease Case)### ----------------------------
###Calculate Demand_Initial Per Capita values#####################################################################################
#Calculate Demand by County For 2015, 2070 and 2150
#Conversion Factor Gallons per day to Acre-feet per year
GALtoAF <- 0.0000030688832459704*365
#2015
D2015$MI_County_ETLow <- ((D2015$Population*D2015$Potable.Use) + (D2015$Population*D2015$ET_Low_Secondary.Use))*GALtoAF
#2070
D2070$MI_County_ETLow <- ((D2070$Population*D2070$Potable.Use) + (D2070$Population*D2070$ET_Low_Secondary.Use))*GALtoAF
#2150
D2150$MI_County_ETLow <- ((D2150$Population*D2150$Potable.Use) + (D2150$Population*D2150$ET_Low_Secondary.Use))*GALtoAF
##Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table
#2015
D2015$MI_SA_ETLow <- D2015$MI_County_ETLow*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)
#2070
D2070$MI_SA_ETLow <- D2070$MI_County_ETLow*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)
#2150
D2150$MI_SA_ETLow <- D2150$MI_County_ETLow*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)
###PerCapita Percent Changes (PCDecrease Scenario)#################################################################################
#Change The Input by ScenarioSA_PcntChanges
#Decrease the Potable Use by 10%
#DecPotable Values won't change with ET
#Decrease the Secondary Use by 34% to make total PerCapita reduction 25%
DecSecondary <- (1 - 0.34)
#2015
D2015$DecSecondary.Use_ETLow <- D2015$ET_Low_Secondary.Use * DecSecondary
#2070
D2070$DecSecondary.Use_ETLow <- D2070$ET_Low_Secondary.Use * DecSecondary
#2150
D2150$DecSecondary.Use_ETLow <- D2150$ET_Low_Secondary.Use * DecSecondary
######Calculate Demand Decreased Values###########################################################################################
#Calculate Demand by County For 2015, 2070 and 2150
#2015
D2015$MI_County_PCDec_ETLow <- ((D2015$Population*D2015$DecPotable.Use) + (D2015$Population*D2015$DecSecondary.Use_ETLow))*GALtoAF
#2070
D2070$MI_County_PCDec_ETLow <- ((D2070$Population*D2070$DecPotable.Use) + (D2070$Population*D2070$DecSecondary.Use_ETLow))*GALtoAF
#2150
D2150$MI_County_PCDec_ETLow <- ((D2150$Population*D2150$DecPotable.Use) + (D2150$Population*D2150$DecSecondary.Use_ETLow))*GALtoAF
###Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table
#2015
D2015$MI_SA_PCDec_ETLow <- D2015$MI_County_PCDec_ETLow*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)
#2070
D2070$MI_SA_PCDec_ETLow <- D2070$MI_County_PCDec_ETLow*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)
#2150
D2150$MI_SA_PCDec_ETLow <- D2150$MI_County_PCDec_ETLow*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)
###With Per Capita Percent Changes  (Drastic Decrease (DD))########################################################################
#Decrease the Potable Use by 20%
#DDPotable Values won't change with ET
#Decrease the Secondary Use by 44%
DDSecondary <- (1 - 0.44)
#2015
D2015$DDSecondary.Use_ETLow <- D2015$ET_Low_Secondary.Use * DDSecondary
#2070
D2070$DDSecondary.Use_ETLow <- D2070$ET_Low_Secondary.Use * DDSecondary
#2150
D2150$DDSecondary.Use_ETLow <- D2150$ET_Low_Secondary.Use * DDSecondary
######Calculate Demand Drastic Decreased Values################################################################################
#Calculate Demand by County For 2015, 2070 and 2150
#2015
D2015$MI_County_PCDD_ETLow <- ((D2015$Population*D2015$DDPotable.Use) + (D2015$Population*D2015$DDSecondary.Use_ETLow))*GALtoAF
#2070
D2070$MI_County_PCDD_ETLow <- ((D2070$Population*D2070$DDPotable.Use) + (D2070$Population*D2070$DDSecondary.Use_ETLow))*GALtoAF
#2150
D2150$MI_County_PCDD_ETLow <- ((D2150$Population*D2150$DDPotable.Use) + (D2150$Population*D2150$DDSecondary.Use_ETLow))*GALtoAF
###Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table
#2015
D2015$MI_SA_PCDD_ETLow <- D2015$MI_County_PCDD_ETLow*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)
#2070
D2070$MI_SA_PCDD_ETLow <- D2070$MI_County_PCDD_ETLow*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)
#2150
D2150$MI_SA_PCDD_ETLow <- D2150$MI_County_PCDD_ETLow*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)
###     Outputs    ################################################################################################################
setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Service Area Demand Scenarios/Output")
#  View(D2015)
#  View(D2070)
#  View(D2150)
#MI ONLY
MI_2015 <- D2015[,c(9,13,17,19,22,25,27,30,33)]
MI_2070 <- D2070[,c(9,13,17,19,22,25,27,30,33)]
MI_2150 <- D2150[,c(9,13,17,19,22,25,27,30,33)]
#add Utah County SA1 Data 35500 to top row
MI_2015[1,]<-35500
MI_2070[1,]<-35500
MI_2150[1,]<-35500
#add SA20 to be 0
MI_2015[20,]<-0
MI_2070[20,]<-0
MI_2150[20,]<-0
colnames(MI_2015) <- paste(colnames(MI_2015),"2015",sep="_")
colnames(MI_2070) <- paste(colnames(MI_2070),"2070",sep="_")
colnames(MI_2150) <- paste(colnames(MI_2150),"2150",sep="_")
MI<- data.frame(c(MI_2015,MI_2070,MI_2150))
#View(MI)
#output to excel
write.xlsx(MI_2015, "MI_2015.xlsx")
write.xlsx(MI_2070, "MI_2070.xlsx")
write.xlsx(MI_2150, "MI_2150.xlsx")
write.xlsx(MI,"MI.xlsx")
#################################################################################################################################################################################################################################################################################################################################################################################################################################################
### Sum Data for plots ###
#################################################################################################################################################################################################################################################################################################################################################################################################################################################
#MI Sums
MISums <- colSums(MI,na.rm=F,dims = 1)
MISums
MISums <-data.frame(MISums)
#SummedScenarios <- data.frame(c(MI2015_Sums,MI2070_Sums,MI2150_Sums))
#row.names(SummedScenarios) <- c("Base","PCDec","PCDD","ET15","PCDec_ET15","PCDD_ET15","ETLow","PCDec_ETLow","PCDD_ETLow")
#2015 Sums
MI2015_Sums <- colSums(MI_2015,na.rm = F, dims = 1)
MI2015_Sums <- data.frame(MI2015_Sums)
#MI2015_Sums$ET <-  c(rep('SameET',3),rep('DecreaseET',3),rep('IncreaseET',3))
#MI2015_Sums$PC <-  rep(c('SamePC','DecreasePC','DrasticDecreasePC'),3)
#MI2015_Sums$NUMPC <-  rep(c(3000,2000,1000),3)
#2070 Sums
MI2070_Sums <- colSums(MI_2070,na.rm = F, dims = 1)
MI2070_Sums <- data.frame(MI2070_Sums)
#MI2070_Sums$ET <- rep(c(rep('SameET',3),rep('DecreaseET',3),rep('IncreaseET',3)),3)
#MI2070_Sums$PC <- rep(rep(c('SamePC','DecreasePC','DrasticDecreasePC'),3),3)
#MI2070_Sums$NUMPC <- rep(rep(c(3000,2000,1000),3),3)
#2150 Sums
MI2150_Sums <- colSums(MI_2150,na.rm = F, dims = 1)
MI2150_Sums <- data.frame(MI2150_Sums)
#MI2150_Sums$ET <- rep(c(rep('SameET',3),rep('DecreaseET',3),rep('IncreaseET',3)),3)
#MI2150_Sums$PC <- rep(rep(c('SamePC','DecreasePC','DrasticDecreasePC'),3),3)
#MI2150_Sums$NUMPC <- rep(rep(c(3000,2000,1000),3),3)
SummedScenarios <- data.frame(c(MI2015_Sums,MI2070_Sums,MI2150_Sums))
row.names(SummedScenarios) <- c("Base","PCDec","PCDD","ET15","PCDec_ET15","PCDD_ET15","ETLow","PCDec_ETLow","PCDD_ETLow")
RowNames <- c("Base","PCDec_ETSame","PCDrD_ETSame","PCBase_ET15","PCDec_ET15","PCDrD_ET15","PCBase_ETLow","PCDec_ETLow","PCDrD_ETLow")
#################################################################################################################################################################################################################################################################################################################################################################################################################################################
### Plots ###
#################################################################################################################################################################################################################################################################################################################################################################################################################################################
#Barplots
Dates <- c("2015", "2070", "2150")
#Per Capita
plot_ly(data=SummedScenarios,x=RowNames, y= ~ MI2015_Sums ,type = 'bar',name = "2015") %>%
add_trace(x=RowNames, y= ~ MI2070_Sums,name = "2070") %>%
add_trace(x=RowNames,y = ~ MI2150_Sums, name = "2150") %>%
layout(yaxis=list(title = 'M&I Demand (acre-feet)',barmode = 'group'))
#### From Last interation of code
Demand_SA[20,]<-c(rep(0))
LabelSA = DWRSA_Table$Description
plot_ly(data =Demand_SA,labels = LabelSA, values=Demand_SA$X2015 ,type = "pie",domain = list(x =c(0,1/3),y=c(0,1))) %>%
add_trace(data =Demand_SA ,labels = LabelSA, values=Demand_SA$X2070,type = "pie",domain =list(x=c(1/3,2/3),y=c(0,1)))%>%
add_trace(data =Demand_SA ,labels = LabelSA, values=Demand_SA$X2150,type = "pie",domain =list(x=c(2/3,1),y=c(0,1)))
## BarPlots without Agriculture
Dates <- c("2015", "2070", "2150")
plot_ly(data = SummedScenarios,x = ~Dates,y= ~SS0 ,type = 'bar', name = 'SS0' ) %>%
add_trace(y = ~SummedScenarios$SS1,name = 'SS1') %>%
add_trace(y = ~SummedScenarios$SS2,name = 'SS2') %>%
add_trace(y = ~SummedScenarios$SS3,name = 'SS3') %>%
add_trace(y = ~SummedScenarios$SS4,name = 'SS4') %>%
add_trace(y = ~SummedScenarios$SS5,name = 'SS5') %>%
add_trace(y = ~SummedScenarios$SS6,name = 'SS6') %>%
add_trace(y = ~SummedScenarios$SS7,name = 'SS7') %>%
add_trace(y = ~SummedScenarios$SS8,name = 'SS8') %>%
layout(yaxis=list(title = 'M&I Demand (acre-feet)',barmode = 'group'))
#Factors Compilation Table
MIAll_Factors<-MI
#View(MIAll_Factors)
#i=1
#while (i<=20) {
# rownames(MIAll_Factors)[i]<-paste0("Potable PerCapita % Change by",paste0(" SA",i))
#i=i+1
#}
rownames(MIAll_Factors)[1]<-"Potable PerCapita % Change"
rownames(MIAll_Factors)[2]<-"Secondary PerCapita % Change"
rownames(MIAll_Factors)[3]<-"Avg Reduced PerCapita % Change"
rownames(MIAll_Factors)[4] <-"PerCapita Change by Scenario"
rownames(MIAll_Factors)[5]<-"ET Change by %"
rownames(MIAll_Factors)[6]<-"ET Change by Scenario"
MIAll_Factors<-MIAll_Factors[1:6,]
#Potable PERCAPITA Changes
MIAll_Factors[1,]<-rep(c(0,10,20),9)
#Secondary PERCAPITA Changes
MIAll_Factors[2,]<-rep(c(0,34,44),9)
#Avg PERCAPITA Changes
MIAll_Factors[3,]<-rep(c(0,25,35),9)
#PERCAPITA Changes by Scenario Name
MIAll_Factors[4,]<-rep(c("Base PC","2025 Goal PC 25% from 2015","Additional 10% Decrease to PC"),9)
#ET Changes by %
MIAll_Factors[5,]<-rep(c(rep(0,3),rep(6,3),rep(15,3)),3)
#ET Changes by Name
MIAll_Factors[6,]<-rep(c(rep("Base ET",3),rep("Low Emission ET",3),rep("Highest Emission ET",3)),3)
#Output MIAll_Factors
write.xlsx(MIAll_Factors,"MI_AllFactors.xlsx")
#######  With Ag move to 2b code   ###################
##BarPlots with Agriculture  -- Only 2015 So Far #
# Move to correct directory
#setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Service Area Demand Scenarios/Input_Data")
#Move back to code directory
setwd(fCodeDir)
#Move into the local input directory
setwd("../1 - Scenario Processing/Annual Service Area Demand Scenarios/Input_Data")
MIAg2015 <- read_excel("MIAG2015.xlsx")
MIAG_2015Summed <- colSums(MIAg2015)
xnotation <-  c("SameET 2015","SameET D2015","SameET DD2015","LowET 2015","LowET D2015","LowET DD2015","ET15 2015","ET15 D2015","ET15 DD2015")
xnotation <-  c("SS0","SS1","SS2","SS3","SS4","SS5","SS6","SS7","SS8")
MIAg2015Summed <- data.frame(xnotation,MIAG_2015Summed)
plot_ly(data = MIAg2015Summed,x =xnotation,y= MIAG_2015Summed ,type = 'bar', name = '2015') %>%
layout(yaxis = list(barmode = 'group'))
# *------------------------------------------------------------------
# | PROGRAM NAME: Approximated Agricultural Demand
# | FILE NAME: Demand_CalcbyServicaArea--Agricultural
# | DATE: 06/05/19
# | CREATED BY:  Jacob Everitt
# *----------------------------------------------------------------
# | PURPOSE:  Develop Approximate Demand Range of usage Agriculture for the Weber
# |Conservancy District.
# |
# |
# *------------------------------------------------------------------
# | STEPS:
# |  0:
# |  1:
# |  2:
# |  3:
# |  4:
# |  5:
# |  6:
# |  7:
# |  8:
# |  9:
# |  10:
# |
# |*------------------------------------------------------------------.
# | DATA USED:
# |
# |https://water.utah.gov/2015WaterData.pdf, December 21, 2018.
# |
# |https://water.utah.gov/OtherReports/MUNICIPAL%20AND%20INDUSTRIAL%20WATER%20USE%20in%20UTAH.pdf, December 21, 2018.
# |
# |https://conservewater.utah.gov/pdf/SamplePlans/WBWCD2013.pdf, December 21, 2018.
# |
# |https://weberbasin.com/, December 21, 2018
# |*------------------------------------------------------------------
# | CONTENTS:
# |  Part 0:
# |  PART 1:
# |  PART 2:
# |  PART 3:
# *-----------------------------------------------------------------
# | UPDATES:
# |
# |
# *------------------------------------------------------------------
### Clear any existing data or functions.
rm(list=ls())
#or not if run directly after Demand_Calc_byServiceArea--Municipal
library(readxl)
#Set Working Directory
#setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Service Area Demand Scenarios/Input_Data")
#Store the current code directory so we can later return to it (0 - Code)
fCodeDir <- getwd()
#Move into the local input directory
#setwd("../1 - Scenario Processing/Annual Service Area Demand Scenarios/Input_Data")
setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Service Area Demand Scenarios/Input_Data")
DWRSA_Table <- read_excel("DWRSA_Table.xlsx")
#Set New Working Directory
#Return to code directory
setwd(fCodeDir)
#Move into the local output directory
#setwd("../1 - Scenario Processing/Annual Service Area Demand Scenarios/Output")
setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Service Area Demand Scenarios/Output")
##Possible package installation necessary
#install.packages("RColorBrewer")
#install.packages("plotly")
#install.packages("readxl")
#install.packages("openxlsx")
library(readxl)
library(plotly)
library(RColorBrewer)
library(openxlsx)
library("tibble", lib.loc="~/R/win-library/3.5")
##Input Data###############
setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Service Area Demand Scenarios/Output")
## Municipal and Industrial water Calculated from 2a_Demand Calc_byServiceArea--Municipal
MI <- read_excel("MI.xlsx")
#View(MI)
MIAll_Factors <- read_excel("MI_AllFactors.xlsx")
##Calculation##############
AGtoMI_CF <- c(0.65,0.72,0.78) #Agriculture to Municipal Water Use Conversion Factor
#-Change in Agriculture----------------------
#Find the Change in MI Water Usage by population
#MI2070_SamePerCap - MI2015_SamePerCap = Changein_MI
Changein_MI_2070to2015 = MI$MI_SA_2070 - MI$MI_SA_2015
Changein_MI_2150to2015 = MI$MI_SA_2150 - MI$MI_SA_2015
##Changein_MI = Changein_AG "0.65AF = 1AF"
##Changein_AG = (Changein_MI/0.65)
#Conversion factor of  0.65
Changein_AG_2070to2015 = data.frame(Changein_MI_2070to2015/AGtoMI_CF[1])  #**put in while loop for differing conversion factors ?
Changein_AG_2150to2015 = data.frame(Changein_MI_2150to2015/AGtoMI_CF[1])
#Conversion factor of  0.72
Changein_AG_2070to2015[,2] = Changein_MI_2070to2015/AGtoMI_CF[2]  #output notation for 0.72 is a ".1" at the end of the column name i.e.MI_SA_2070.1
Changein_AG_2150to2015[,2] = Changein_MI_2150to2015/AGtoMI_CF[2]
#Conversion factor of 0.78
Changein_AG_2070to2015[,3] = Changein_MI_2070to2015/AGtoMI_CF[3]  #output notation for 0.78 is a ".2" at the end of the column name i.e.MI_SA_2070.2
Changein_AG_2150to2015[,3] = Changein_MI_2150to2015/AGtoMI_CF[3]
#Agricultural Base Usage--------
#BaseDemand <- data.frame(DWRSA_Table$MAX) #MAX AG WATER USE
BaseDemand <- data.frame(DWRSA_Table$AVG)    #OR AVG AG WATER USE
BaseDemand[20,] <- 0
#The amount of Agricultural Water Used found by looking at the recorded Total Base 2015 water demands and subtracting the calculated
#2015 Municipal and Industrial water usage
AgBase2015 <- BaseDemand - MI$MI_SA_2015
#View(AgBase2015)
i=1
AG_2015 <- AgBase2015
AG_2070 <- data.frame(rep(1:20))
AG_2150 <- data.frame(rep(1:20))
while (i<=3) {
AG_2070[,i] <- data.frame(AgBase2015 - Changein_AG_2070to2015[,i])
AG_2150[,i] <- data.frame(AgBase2015 - Changein_AG_2150to2015[,i])
i=i+1
}
AG_2070[,1:3] <- replace(AG_2070[,1:3], AG_2070[,1:3] < 0, 0)
AG_2150[,1:3] <- replace(AG_2150[,1:3], AG_2150[,1:3] < 0, 0)
colnames(AG_2070)<-c("_65% Conversion Factor","_72% Conversion Factor","_78% Conversion Factor")
colnames(AG_2150)<-c("_65% Conversion Factor","_72% Conversion Factor","_78% Conversion Factor")
#########################################################################################################
#Evaporation for Agriculture 5% moderate emissions  8% high emissions
AG_2070<- AG_2070*1.05
AG_2150<- AG_2150*1.08
#########################################################################################################
#ADD AG to MI ###############################
#MI + Base Ag
#2015 BaseDemand
MIandAg_Demand <- data.frame(AG_2015[,1] + MI$MI_SA_2015)
i=1
j=1
while (i<=9) {
MIandAg_Demand[,j] <- AG_2015[,1] + MI[,i]
i=i+1
j=j+1
}
colnames(MIandAg_Demand)[1]<-"MI_SA_2015"
#View(MIandAg_Demand)
#2070
k=1
while (k<=3) {
while (i<=18) {
MIandAg_Demand[,j] <- AG_2070[,k] + MI[,i]
colnames(MIandAg_Demand)[j]<-paste0(colnames(MI)[i],colnames(AG_2070)[k])
i=i+1
j=j+1
}
k=k+1
i=10
}
#View(MIandAg_Demand)
#2150
i=19
k=1
while (k<=3) {
while (i<=27) {
MIandAg_Demand[,j] <- AG_2150[,k] + MI[,i]
colnames(MIandAg_Demand)[j]<-paste0(colnames(MI)[i],colnames(AG_2150)[k])
i=i+1
j=j+1
}
k=k+1
i=19
}
#View(MIandAg_Demand)
#MIandAg_Demand Compilaton
##Output Data############################################
#write.xlsx(MIandAg_Demand,"MI_with_AG.xlsx")
write.csv(MIandAg_Demand,"MI_with_AG.csv")
#View(MIandAg_Demand)
#Tab---- Create Workbook-----------
#Input How Many Scenarios                  #### Nine 2015 Scenarios, Twenty-Seven 2070 Scenarios, and Twenty-Seven 2150 Scenarios
#### 63 Total MI plus Ag Scenarios ########
RunNumber <- 63
#Create Workbook
wb <- createWorkbook("Data")
#Create Worksheet for each Run
for(Num in 1:(RunNumber)) {
RunsString <- paste0("Trace",Num)
addWorksheet(wb, RunsString)
}
#Input Data
SAs<- c('SA1','SA2','SA3','SA4','SA5','SA6','SA7','SA8','SA9','SA10','SA11','SA12','SA13','SA14','SA15','SA16','SA17','SA18','SA19','SA20')
i=1
while (i<=RunNumber) {
writeData(wb,sheet = i, SAs,startCol = 1,startRow = 3)
i=i+1
}
i=1
while (i<=RunNumber) {
writeData(wb,sheet = i, MIandAg_Demand[,i],startCol = 2,startRow = 3)
i=i+1
}
##Save workbook
saveWorkbook(wb,"MI+AG.xlsx",overwrite = TRUE)
#################################################################################################################################################################################################################################################################################################################################################################################################################################################
### Sum Data for plots ###
#################################################################################################################################################################################################################################################################################################################################################################################################################################################
#MIandAg_Demand Sums
#Create Data frame
MIandAG_Sums <- t(colnames(MIandAg_Demand))
i=1
while (i<=63) {
MIandAG_Sums[,i] <- sum(MIandAg_Demand[,i])
i=i+1
}
MIandAG_Sums<- data.frame(MIandAG_Sums)
Nms<-t(colnames(MIandAg_Demand))
names(MIandAG_Sums) <- c(Nms)
#View(MIandAG_Sums)
#Transpose Data
DemandData <- data.frame(t(MIandAG_Sums))
#Name Column
names(DemandData)[1] <- paste("MI + AG")
#Year Column
Year <- c(rep(2015,9),rep(2070,27),rep(2150,27))
DemandData$Year<-Year
#AgConversion Column
AGCF<-c(rep(0,9),rep(c(rep(65,9), rep(72,9), rep(78,9)),2))
DemandData$AG_Conversion.Factor <-AGCF
#Scenario Name Column
DemandData$Scenario_Name<-rownames(DemandData)
#Add MI Factors
rownames(MIAll_Factors)[1]<-"Potable PerCapita % Change"
rownames(MIAll_Factors)[2]<-"Secondary PerCapita % Change"
rownames(MIAll_Factors)[3]<-"Avg Reduced PerCapita % Change"
rownames(MIAll_Factors)[4] <-"PerCapita Change by Scenario"
rownames(MIAll_Factors)[5]<-"ET Change by %"
rownames(MIAll_Factors)[6]<-"ET Change by Scenario"
Transposed_MIAllFactors <-t(MIAll_Factors)
MI_Factors_2015<-Transposed_MIAllFactors[1:9,]
MI_Factors_2070<-Transposed_MIAllFactors
rownames(MI_Factors_2070) <- rownames(DemandData)[10:36]
MI_Factors_2150<-Transposed_MIAllFactors
rownames(MI_Factors_2070) <- rownames(DemandData)[37:63]
MI_Factors<- rbind(MI_Factors_2015,MI_Factors_2070,MI_Factors_2150)
rownames(MI_Factors)<-rownames(DemandData)
colnames(MI_Factors)<-colnames(Transposed_MIAllFactors)
AllDemandData <- cbind(DemandData,MI_Factors)
#View(AllDemandData)
Data<-AllDemandData
#MI+Ag_Sums
plot_ly(data =Data , x="Year 2015", y=Data$`MI + AG`,type='scatter',mode='markers',
size = Data$`Avg Reduced PerCapita % Change`,color = Data$AG_Conversion.Factor,colors = blues9)%>%
#add_trace(x='Year 2070', y=MIAG$MIAG2070_Sums,name = MIAG$Names_2070)%>%
#add_trace(x= 'Year 2150',y=MIAG$MIAG2150_Sums,name = MIAG$Names_2150)%>%
layout(yaxis = list(title ='M&I + AG Demand (acre-feet)',tickformat = '.1f',showticklabels=FALSE),showlegend = FALSE)
View(Data)
plot_ly(data =Data , x=Data$Year, y=Data$`MI + AG`,type='scatter',mode='markers',
size = Data$`Avg Reduced PerCapita % Change`,color = Data$AG_Conversion.Factor,colors = blues9)%>%
#add_trace(x='Year 2070', y=MIAG$MIAG2070_Sums,name = MIAG$Names_2070)%>%
#add_trace(x= 'Year 2150',y=MIAG$MIAG2150_Sums,name = MIAG$Names_2150)%>%
layout(yaxis = list(title ='M&I + AG Demand (acre-feet)',tickformat = '.1f',showticklabels=FALSE),showlegend = FALSE)
plot_ly(data =Data , x=Data$Year, y=Data$`MI + AG`,type='scatter',mode='markers',
size = Data$`Avg Reduced PerCapita % Change`,color = Data$AG_Conversion.Factor,colors = blues9) #%>%
plot_ly(data =Data , x=Data$Year, y=Data$`MI + AG`,type='scatter',mode='markers')
plot_ly(data =Data , x=Data$Year, y=Data$`MI + AG`,type='scatter',mode='markers',size = Data$`Avg Reduced PerCapita % Change`)
plot_ly(data =Data , x=Data$Year, y=Data$`MI + AG`,type='scatter',mode='markers',size = Data$AG_Conversion.Factor)
plot_ly(
x = Data$AG_Conversion.Factor,
y = Data$`Avg Reduced PerCapita % Change`,
z = Data$`MI + AG`, type = "contour",contours = list(showlabels = TRUE),showscale = T, colors = c("white","orange"))%>%
colorbar(title = "Percent of\n Years below \n Storage Level"))
plot_ly(
x = Data$AG_Conversion.Factor,
y = Data$`Avg Reduced PerCapita % Change`,
z = Data$`MI + AG`, type = "contour",contours = list(showlabels = TRUE),showscale = T,
colors = c("white","orange"))
plot_ly(
x = Data$AG_Conversion.Factor,
y = Data$`Avg Reduced PerCapita % Change`,
z = Data$`MI + AG`, type = "contour",contours = list(showlabels = TRUE),showscale = T)
plot_ly(data =Data , x=Data$Year, y=Data$`MI + AG`,type='scatter',mode='markers',
size = Data$`Avg Reduced PerCapita % Change`,color = Data$AG_Conversion.Factor,colors = blues9) #%>%
plot_ly(data =Data , x=Data$Year, y=Data$`MI + AG`,type='scatter',mode='markers',
size = Data$`Secondary PerCapita % Change`,color = Data$AG_Conversion.Factor,colors = blues9) #%>%
plot_ly(data =Data , x=Data$Year, y=Data$`MI + AG`,type='scatter',mode='markers',
size = Data$AG_Conversion.Factor,color = Data$AG_Conversion.Factor,colors = blues9) #%>%
plot_ly(data =Data , x=Data$Year, y=Data$`MI + AG`,type='scatter',mode='markers',
size = Data$`ET Change by %`,color = Data$AG_Conversion.Factor,colors = blues9) #%>%
plot_ly(data =Data , x=Data$Year, y=Data$`MI + AG`,type='scatter',mode='markers',
size = Data$AG_Conversion.Factor,color = Data$`ET Change by %`,colors = blues9) #%>%
#add_trace(x='Year 2070', y=MIAG$MIAG2070_Sums,name = MIAG$Names_2070)%>%
#add_trace(x= 'Year 2150',y=MIAG$MIAG2150_Sums,name = MIAG$Names_2150)%>%
layout(yaxis = list(title ='M&I + AG Demand (acre-feet)',tickformat = '.1f',showticklabels=FALSE),showlegend = FALSE)
plot_ly(data =Data , x=Data$Year, y=Data$`MI + AG`,type='scatter',mode='markers',
size = Data$AG_Conversion.Factor,color = Data$`ET Change by %`,colors = blues9) %>%
#add_trace(x='Year 2070', y=MIAG$MIAG2070_Sums,name = MIAG$Names_2070)%>%
#add_trace(x= 'Year 2150',y=MIAG$MIAG2150_Sums,name = MIAG$Names_2150)%>%
layout(yaxis = list(title ='M&I + AG Demand (acre-feet)',tickformat = '.1f',showticklabels=FALSE),showlegend = FALSE)
plot_ly(data =Data , x=Data$Year, y=Data$`MI + AG`,type='scatter',mode='markers',
size = Data$AG_Conversion.Factor,color = Data$`ET Change by %`,colors = blues9) %>%
#add_trace(x='Year 2070', y=MIAG$MIAG2070_Sums,name = MIAG$Names_2070)%>%
#add_trace(x= 'Year 2150',y=MIAG$MIAG2150_Sums,name = MIAG$Names_2150)%>%
layout(yaxis = list(title ='M&I + AG Demand (acre-feet)',tickformat = '.1f',showticklabels=T),showlegend = FALSE)
