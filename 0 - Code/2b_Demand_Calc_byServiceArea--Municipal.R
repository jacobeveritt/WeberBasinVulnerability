# *------------------------------------------------------------------
# | PROGRAM NAME: Service Area Divided Annual Demands
# | FILE NAME: SAdividedCounty_Demands
# | DATE: 3/11/18
# | CREATED BY:  Jacob Everitt
# *----------------------------------------------------------------
# | PURPOSE:  Develop Approximate Demand Range Outputs for the Weber
# |Conservancy District, using a series of scenario options, using
# |2013 WBWCD report for projected data.(See"Scenarios_DemandNotations")
# |
# |
# *------------------------------------------------------------------
# | STEPS:
# |  0:  For Counties
# |  1:  Input data, Manually Written in Code
# |  2:  Input Scenario Specification
# |  3:  Create a new Data Frame
# |  4:  Assign Population values to Notation
# |  5:  Calculate Per-Capita Outdoor Usage in GPCD
# |  6:  Calculate Per-Capita Indoor Usage in GPCD
# |  7:  Calculate Net Evap GPCD
# |  8:  Convert all GPCD units to Acre-Feet/year
# |  9:  Sum all Usage
# |  10: Sum With Agricultural Demand to find Total Demand.
# |
# |*------------------------------------------------------------------.
# | DATA USED:
# |
# |https://water.utah.gov/2015WaterData.pdf, December 21, 2018.
# |
# |https://water.utah.gov/OtherReports/MUNICIPAL%20AND%20INDUSTRIAL%20WATER%20USE%20in%20UTAH.pdf, December 21, 2018.
# |
# |https://conservewater.utah.gov/pdf/SamplePlans/WBWCD2013.pdf, December 21, 2018.
# |
# |https://weberbasin.com/, December 21, 2018

# |*------------------------------------------------------------------
# | CONTENTS:
# |  Part 0: Excel File #WBCDDemand_Workbook_County <- read_excel("WBCDDemand-Workbook_County.xlsx")
# |  PART 1:
# |  PART 2:
# |  PART 3:
# *-----------------------------------------------------------------
# | UPDATES:
# |
# |
# *------------------------------------------------------------------

### Clear any existing data or functions.
rm(list=ls())

#Set Working Directory
#setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Service Area Demand Scenarios/Input_Data")
#Store the current code directory so we can later return to it (0 - Code)
fCodeDir <- getwd()
#Move into the local input directory
setwd("../1 - Scenario Processing/Annual Service Area Demand Scenarios/Input_Data")

##Possible package installation necessary
#install.packages("RColorBrewer")
#install.packages("plotly")
#install.packages("readxl")
#install.packages("openxlsx")
library(readxl)
library(plotly)
library(RColorBrewer)
library(openxlsx)

          ##Input Data Table of Contents##

## Municipal and Industrial water INPUTS
  # 1- County Per Capita Usage
  # 2- County Populations 2015, 2070, 2150
  # 3- County Evapotranspiration
  # 4- Per Capita Usage
    #a)Indoor Municipal Per Capita: Same, Reduced, Drastically Reduced
    #b)Outdoor Municipal Per Capita: Same, Reduced, Drastically Reduced
  # 5- Misc.

#----------------------------### Inputs ### ------------------------------------------------------------------------------------------------------------------------------------------
#1 & #2 Inputs By County and Year (Population and Per Capita Usage)
    D2015<-read.csv("2015Data.csv")
    D2070<-read.csv("2070Data.csv")
    D2150<-read.csv("2150Data.csv")

#3 Evapotranspiration
  #Evapotranspiration Scenarios
    # a. Increased Usage due to Evapotranspiration
    # b. No Change (No Calculation Necessary)
    # c. Decreased Usage due to Increased Evapotranspiration therefore greater Precipitation

    #Change in Evapotranspiration is 15% Acre-Feet
    #Therefore assumed (+/-)15% Change in Usage

    ChangeinUsage_ET_IncreaseFactor = 1.15
    ChangeinUsage_ET_DecreaseFactor = 0.85
  #a.
    D2015ET_Increase <- D2015
      D2015ET_Increase$Secondary.Use <- D2015ET_Increase$Secondary.Use * ChangeinUsage_ET_IncreaseFactor

    D2070ET_Increase <- D2070
      D2070ET_Increase$Secondary.Use <- D2070ET_Increase$Secondary.Use * ChangeinUsage_ET_IncreaseFactor

    D2150ET_Increase <- D2150
      D2150ET_Increase$Secondary.Use <- D2150ET_Increase$Secondary.Use * ChangeinUsage_ET_IncreaseFactor
  #b.
    D2015ET_Same <- D2015

    D2070ET_Same <- D2070

    D2150ET_Same <- D2150
  #c.
    D2015ET_Decrease <- D2015
      D2015ET_Decrease$Secondary.Use <- D2015ET_Decrease$Secondary.Use * ChangeinUsage_ET_DecreaseFactor

    D2070ET_Decrease <- D2070
      D2070ET_Decrease$Secondary.Use <- D2070ET_Decrease$Secondary.Use * ChangeinUsage_ET_DecreaseFactor

    D2150ET_Decrease <- D2150
      D2150ET_Decrease$Secondary.Use <- D2150ET_Decrease$Secondary.Use * ChangeinUsage_ET_DecreaseFactor

#4 Scenarios Input (0%, 25% and 40% reduction)
ScenarioSA_PCntChanges <- read_excel("PercentChanges.xlsx")

#5 Misc Data
#Division of Water Resources Service Area Table
DWRSA_Table <- read_excel("DWRSA_Table.xlsx")

######################################################################################################################################################################################

  ### -- Demand Calculations for Differing ET, Populations and Per-Capita Usage Reductions -- ###

######################################################################################################################################################################################
###ET Scenario a. Increased Usage due to ET (Increase Case)###
###Calculate Per-Capita Demand Initial values####################################################################################################################################################################################

#Create DataFrame
Demand_County <- data.frame(Utah= c(rep(NA)),Box_Elder = c(rep(NA)),Davis = c(rep(NA)), Morgan = c(rep(NA)),Summit = c(rep(NA)), Weber= c(rep(NA)),Dates = c(2015,2070,2150))

#Calculate Demand by County For 2015, 2070 and 2150

#2015
i=1
while (i<=6) {
  Demand_County[1,i] <- D2015ET_Increase[i,3]*D2015ET_Increase[i,4] +D2015ET_Increase[i,3]*D2015ET_Increase[i,5]
  i=i+1}

#2070
i=1
while (i<=6) {
  Demand_County[2,i] <- D2070ET_Increase[i,3]*D2070ET_Increase[i,4] +D2070ET_Increase[i,3]*D2070ET_Increase[i,5]
  i=i+1}

#2150
i=1
while (i<=6) {
  Demand_County[3,i] <- D2150ET_Increase[i,3]*D2150ET_Increase[i,4] +D2150ET_Increase[i,3]*D2150ET_Increase[i,5]
  i=i+1}

Demand_County

#Conversion from Gallons per day to Acre-feet per year

Demand_County <- Demand_County*0.0000030688832459704*365

Demand_County[1:3,7]<-c(2015,2070,2150)
Demand_County

#Input Base Utah County Values
Demand_County[1:3,1] <- c(rep(35500))
Demand_County

#Input Calculated Total County Demand
DWRSA_Table$Counties <- c(Demand_County[1,1],Demand_County[1,5],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,4],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,3],Demand_County[1,3],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6])

#Create a New Dataframe for Demand by Service Area
Demand_SA <- data.frame('2015' = c(1:19),'2070' = c(1:19),'2150' = c(1:19))

#Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table
#2015

i=1
while (i<=19) {
  Demand_SA[i,1] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
}

#2070
i=1
year=2

DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

while (i<=19) {
  Demand_SA[i,2] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
}

#2150
year=3
i=1

DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

while (i<=19) {
  Demand_SA[i,3] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
}

MIDemand_SAbyPopulation <- Demand_SA

#View(MIDemand_SAbyPopulation)

###With PerCapita Percent Changes (Decrease Scenario)#####################################################################################################################################################################################

#Change The Input by ScenarioSA_PcntChanges

#Decrease the Potable Use by 10%
#SC = Scenario Column (e.i. Same, Decrease, Increase, Drastic Decrease, Drastic Increase)

SC = 4 # Decrease

#2015
i=2
while (i<=6) {D2015ET_Increase[i,4]<-D2015ET_Increase[i,4]-(D2015ET_Increase[i,4]*ScenarioSA_PCntChanges[1,SC])
i=i+1
}

#2070
i=2
while (i<=6) {D2070ET_Increase[i,4]<-D2070ET_Increase[i,4]-(D2070ET_Increase[i,4]*ScenarioSA_PCntChanges[1,SC])
i=i+1
}

#2150
i=2
while (i<=6) {D2150ET_Increase[i,4]<-D2150ET_Increase[i,4]-(D2150ET_Increase[i,4]*ScenarioSA_PCntChanges[1,SC])
i=i+1
}

#Decrease the Secondary Use by 34% to make total PerCapita reduction 25%
#2015
i=2
while (i<=6) {D2015ET_Increase[i,5]<-D2015ET_Increase[i,5]-(D2015ET_Increase[i,5]*ScenarioSA_PCntChanges[2,SC])
i=i+1
}

#2070
i=2
while (i<=6) {D2070ET_Increase[i,5]<-D2070ET_Increase[i,5]-(D2070ET_Increase[i,5]*ScenarioSA_PCntChanges[2,SC])
i=i+1
}

#2150
i=2
while (i<=6) {D2150ET_Increase[i,5]<-D2150ET_Increase[i,5]-(D2150ET_Increase[i,5]*ScenarioSA_PCntChanges[2,SC])
i=i+1
}

##Calculate Per-Capita Demand Initial values

#Create DataFrame
i=1

Demand_County <- data.frame(Utah= c(rep(NA)),Box_Elder = c(rep(NA)),Davis = c(rep(NA)), Morgan = c(rep(NA)),Summit = c(rep(NA)), Weber= c(rep(NA)),Dates = c(2015,2070,2150))

#Calculate Demand by County For 2015, 2070 and 2150

#2015
while (i<=6) {
  Demand_County[1,i] <- D2015ET_Increase[i,3]*D2015ET_Increase[i,4] +D2015ET_Increase[i,3]*D2015ET_Increase[i,5]
  i=i+1}

#2070
i=1
while (i<=6) {
  Demand_County[2,i] <- D2070ET_Increase[i,3]*D2070ET_Increase[i,4] +D2070ET_Increase[i,3]*D2070ET_Increase[i,5]
  i=i+1}

#2150
i=1
while (i<=6) {
  Demand_County[3,i] <- D2150ET_Increase[i,3]*D2150ET_Increase[i,4] +D2150ET_Increase[i,3]*D2150ET_Increase[i,5]
  i=i+1}

Demand_County


#Conversion from Gallons per day to Acre-feet per year

Demand_County <- Demand_County*0.0000030688832459704*365

Demand_County[1:3,7]<-c(2015,2070,2150)

Demand_County

#Input Base Utah County Values

Demand_County[1:3,1] <- c(rep(35500))
Demand_County

#Input Calculated Total County Demand
DWRSA_Table$Counties <- c(Demand_County[1,1],Demand_County[1,5],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,4],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,3],Demand_County[1,3],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6])

#Create a New Dataframe for Demand by Service Area
Demand_SA_D <- data.frame('2015' = c(1:19),'2070' = c(1:19),'2150' = c(1:19))

#Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

#2015
i=1
while (i<=19) {
  Demand_SA_D[i,1] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
}

#2070
i=1
year=2

DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

while (i<=19) {
  Demand_SA_D[i,2] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
}

#2150
year=3
i=1

DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

while (i<=19) {
  Demand_SA_D[i,3] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
}

#Demand_SA_D

###With Per Capita Percent Changes  (Drastic Decrease (DD))###########################################################################################################################################################################################################################################################

#Change The Input by ScenarioSA_PcntChanges

#Reset Values
#1 & #2 Inputs By County and Year

D2015ET_Increase <- D2015
D2015ET_Increase$Secondary.Use <- D2015ET_Increase$Secondary.Use * ChangeinUsage_ET_IncreaseFactor

D2070ET_Increase <- D2070
D2070ET_Increase$Secondary.Use <- D2070ET_Increase$Secondary.Use * ChangeinUsage_ET_IncreaseFactor

D2150ET_Increase <- D2150
D2150ET_Increase$Secondary.Use <- D2150ET_Increase$Secondary.Use * ChangeinUsage_ET_IncreaseFactor

#SC = Scenario Column (e.i. Same, Decrease, Increase, Drastic Decrease, Drastic Increase)

SC = 6 #Drastic Decrease

#Decrease the Potable Use by 20%

#2015
i=2
while (i<=6) {D2015ET_Increase[i,4]<-D2015ET_Increase[i,4]-(D2015ET_Increase[i,4]*ScenarioSA_PCntChanges[1,SC])
i=i+1
}

#2070
i=2
while (i<=6) {D2070ET_Increase[i,4]<-D2070ET_Increase[i,4]-(D2070ET_Increase[i,4]*ScenarioSA_PCntChanges[1,SC])
i=i+1
}

#2150
i=2
while (i<=6) {D2150ET_Increase[i,4]<-D2150ET_Increase[i,4]-(D2150ET_Increase[i,4]*ScenarioSA_PCntChanges[1,SC])
i=i+1
}

#Decrease the Secondary Use by 44%
#2015
i=2
while (i<=6) {D2015ET_Increase[i,5]<-D2015ET_Increase[i,5]-(D2015ET_Increase[i,5]*ScenarioSA_PCntChanges[2,SC])
i=i+1
}

#2070
i=2
while (i<=6) {D2070ET_Increase[i,5]<-D2070ET_Increase[i,5]-(D2070ET_Increase[i,5]*ScenarioSA_PCntChanges[2,SC])
i=i+1
}

#2150
i=2
while (i<=6) {D2150ET_Increase[i,5]<-D2150ET_Increase[i,5]-(D2150ET_Increase[i,5]*ScenarioSA_PCntChanges[2,SC])
i=i+1
}

##Calculate Per-Capita Demand Initial values

#Create DataFrame
i=1

Demand_County <- data.frame(Utah= c(rep(NA)),Box_Elder = c(rep(NA)),Davis = c(rep(NA)), Morgan = c(rep(NA)),Summit = c(rep(NA)), Weber= c(rep(NA)),Dates = c(2015,2070,2150))

#Calculate Demand by County For 2015, 2070 and 2150

#2015
while (i<=6) {
  Demand_County[1,i] <- D2015ET_Increase[i,3]*D2015ET_Increase[i,4] +D2015ET_Increase[i,3]*D2015ET_Increase[i,5]
  i=i+1}

#2070
i=1
while (i<=6) {
  Demand_County[2,i] <- D2070ET_Increase[i,3]*D2070ET_Increase[i,4] +D2070ET_Increase[i,3]*D2070ET_Increase[i,5]
  i=i+1}

#2150
i=1
while (i<=6) {
  Demand_County[3,i] <- D2150ET_Increase[i,3]*D2150ET_Increase[i,4] +D2150ET_Increase[i,3]*D2150ET_Increase[i,5]
  i=i+1}

Demand_County


#Conversion from Gallons per day to Acre-feet per year

Demand_County <- Demand_County*0.0000030688832459704*365

Demand_County[1:3,7]<-c(2015,2070,2150)

Demand_County

#Input Base Utah County Values

Demand_County[1:3,1] <- c(rep(35500))
Demand_County

#Input Calculated Total County Demand
DWRSA_Table$Counties <- c(Demand_County[1,1],Demand_County[1,5],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,4],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,3],Demand_County[1,3],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6])

#Create a New Dataframe for Demand by Service Area
Demand_SA_DD <- data.frame('2015' = c(1:19),'2070' = c(1:19),'2150' = c(1:19))



#Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

#2015
i=1
while (i<=19) {
  Demand_SA_DD[i,1] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
}

#2070
i=1
year=2

DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

while (i<=19) {
  Demand_SA_DD[i,2] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
}

#2150
year=3
i=1

DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

while (i<=19) {
  Demand_SA_DD[i,3] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
}

#Outputs

  Demand_SA_ET_Increase <- Demand_SA
  Demand_SA_D_ET_Increase <- Demand_SA_D
  Demand_SA_DD_ET_Increase <- Demand_SA_DD

######################################################################################################################################################################################
###ET Scenario b. Same ET (Base Case)###
######################################################################################################################################################################################

##Calculate Per-Capita Demand Initial values

#Create DataFrame
i=1

Demand_County <- data.frame(Utah= c(rep(NA)),Box_Elder = c(rep(NA)),Davis = c(rep(NA)), Morgan = c(rep(NA)),Summit = c(rep(NA)), Weber= c(rep(NA)),Dates = c(2015,2070,2150))

#Calculate Demand by County For 2015, 2070 and 2150

#2015
while (i<=6) {
  Demand_County[1,i] <- D2015ET_Same[i,3]*D2015ET_Same[i,4] +D2015ET_Same[i,3]*D2015ET_Same[i,5]
  i=i+1}

#2070
i=1
while (i<=6) {
  Demand_County[2,i] <- D2070ET_Same[i,3]*D2070ET_Same[i,4] +D2070ET_Same[i,3]*D2070ET_Same[i,5]
  i=i+1}

#2150
i=1
while (i<=6) {
  Demand_County[3,i] <- D2150ET_Same[i,3]*D2150ET_Same[i,4] +D2150ET_Same[i,3]*D2150ET_Same[i,5]
  i=i+1}

    Demand_County

  #Conversion from Gallons per day to Acre-feet per year

    Demand_County <- Demand_County*0.0000030688832459704*365

    Demand_County[1:3,7]<-c(2015,2070,2150)
        Demand_County
  #Input Base Utah County Values
    Demand_County[1:3,1] <- c(rep(35500))
        Demand_County

  #Input Calculated Total County Demand
  DWRSA_Table$Counties <- c(Demand_County[1,1],Demand_County[1,5],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,4],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,3],Demand_County[1,3],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6])

  #Create a New Dataframe for Demand by Service Area
  Demand_SA <- data.frame('2015' = c(1:19),'2070' = c(1:19),'2150' = c(1:19))

#Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

##vlookup
#2015

i=1
while (i<=19) {
  Demand_SA[i,1] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
}

#2070
i=1
year=2

DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

while (i<=19) {
  Demand_SA[i,2] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
}

#2150
year=3
i=1

DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

while (i<=19) {
  Demand_SA[i,3] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
}

MIDemand_SAbyPopulation <- Demand_SA

#View(MIDemand_SAbyPopulation)

###With PerCapita Percent Changes (Decrease Scenario)#####################################################################################################################################################################################
    #Change The Input by ScenarioSA_PcntChanges

  #Decrease the Potable Use by 10%
  #SC = Scenario Column (e.i. Same, Decrease, Increase, Drastic Decrease, Drastic Increase)

  SC = 4 # Decrease

  #2015
  i=2
  while (i<=6) {D2015ET_Same[i,4]<-D2015ET_Same[i,4]-(D2015ET_Same[i,4]*ScenarioSA_PCntChanges[1,SC])
  i=i+1
  }

  #2070
  i=2
  while (i<=6) {D2070ET_Same[i,4]<-D2070ET_Same[i,4]-(D2070ET_Same[i,4]*ScenarioSA_PCntChanges[1,SC])
  i=i+1
  }

  #2150
  i=2
  while (i<=6) {D2150ET_Same[i,4]<-D2150ET_Same[i,4]-(D2150ET_Same[i,4]*ScenarioSA_PCntChanges[1,SC])
  i=i+1
  }

  #Decrease the Secondary Use by 34% to make total PerCapita reduction 25%
  #2015
  i=2
  while (i<=6) {D2015ET_Same[i,5]<-D2015ET_Same[i,5]-(D2015ET_Same[i,5]*ScenarioSA_PCntChanges[2,SC])
  i=i+1
  }

  #2070
  i=2
  while (i<=6) {D2070ET_Same[i,5]<-D2070ET_Same[i,5]-(D2070ET_Same[i,5]*ScenarioSA_PCntChanges[2,SC])
  i=i+1
  }

  #2150
  i=2
  while (i<=6) {D2150ET_Same[i,5]<-D2150ET_Same[i,5]-(D2150ET_Same[i,5]*ScenarioSA_PCntChanges[2,SC])
  i=i+1
  }

  ##Calculate Per-Capita Demand Initial values

  #Create DataFrame
  i=1

  Demand_County <- data.frame(Utah= c(rep(NA)),Box_Elder = c(rep(NA)),Davis = c(rep(NA)), Morgan = c(rep(NA)),Summit = c(rep(NA)), Weber= c(rep(NA)),Dates = c(2015,2070,2150))

  #Calculate Demand by County For 2015, 2070 and 2150

  #2015
  while (i<=6) {
    Demand_County[1,i] <- D2015ET_Same[i,3]*D2015ET_Same[i,4] +D2015ET_Same[i,3]*D2015ET_Same[i,5]
    i=i+1}

  #2070
  i=1
  while (i<=6) {
    Demand_County[2,i] <- D2070ET_Same[i,3]*D2070ET_Same[i,4] +D2070ET_Same[i,3]*D2070ET_Same[i,5]
    i=i+1}

  #2150
  i=1
  while (i<=6) {
    Demand_County[3,i] <- D2150ET_Same[i,3]*D2150ET_Same[i,4] +D2150ET_Same[i,3]*D2150ET_Same[i,5]
    i=i+1}

  Demand_County


  #Conversion from Gallons per day to Acre-feet per year

  Demand_County <- Demand_County*0.0000030688832459704*365

  Demand_County[1:3,7]<-c(2015,2070,2150)

  Demand_County

  #Input Base Utah County Values

  Demand_County[1:3,1] <- c(rep(35500))
  Demand_County

  #Input Calculated Total County Demand
  DWRSA_Table$Counties <- c(Demand_County[1,1],Demand_County[1,5],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,4],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,3],Demand_County[1,3],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6])

  #Create a New Dataframe for Demand by Service Area
  Demand_SA_D <- data.frame('2015' = c(1:19),'2070' = c(1:19),'2150' = c(1:19))

  #Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

  #2015
  i=1
  while (i<=19) {
    Demand_SA_D[i,1] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
    i=i+1
  }

  #2070
  i=1
  year=2

  DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

  while (i<=19) {
    Demand_SA_D[i,2] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
    i=i+1
  }

  #2150
  year=3
  i=1

  DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

  while (i<=19) {
    Demand_SA_D[i,3] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
    i=i+1
  }

  #Demand_SA_D

##With Per Capita Percent Changes  (Drastic Decrease (DD))###########################################################################################################################################################################################################################################################
#Change The Input by ScenarioSA_PcntChanges

#Reset Values
#1 & #2 Inputs By County and Year

  D2015ET_Same <- D2015

  D2070ET_Same <- D2070

  D2150ET_Same <- D2150

#SC = Scenario Column (e.i. Same, Decrease, Increase, Drastic Decrease, Drastic Increase)

SC = 6 #Drastic Decrease

#Decrease the Potable Use by 20%

#2015
i=2
while (i<=6) {D2015ET_Same[i,4]<-D2015ET_Same[i,4]-(D2015ET_Same[i,4]*ScenarioSA_PCntChanges[1,SC])
i=i+1
}

#2070
i=2
while (i<=6) {D2070ET_Same[i,4]<-D2070ET_Same[i,4]-(D2070ET_Same[i,4]*ScenarioSA_PCntChanges[1,SC])
i=i+1
}

#2150
i=2
while (i<=6) {D2150ET_Same[i,4]<-D2150ET_Same[i,4]-(D2150ET_Same[i,4]*ScenarioSA_PCntChanges[1,SC])
i=i+1
}

#Decrease the Secondary Use by 44%
#2015
i=2
while (i<=6) {D2015ET_Same[i,5]<-D2015ET_Same[i,5]-(D2015ET_Same[i,5]*ScenarioSA_PCntChanges[2,SC])
i=i+1
}

#2070
i=2
while (i<=6) {D2070ET_Same[i,5]<-D2070ET_Same[i,5]-(D2070ET_Same[i,5]*ScenarioSA_PCntChanges[2,SC])
i=i+1
}

#2150
i=2
while (i<=6) {D2150ET_Same[i,5]<-D2150ET_Same[i,5]-(D2150ET_Same[i,5]*ScenarioSA_PCntChanges[2,SC])
i=i+1
}

##Calculate Per-Capita Demand Initial values

#Create DataFrame
i=1

Demand_County <- data.frame(Utah= c(rep(NA)),Box_Elder = c(rep(NA)),Davis = c(rep(NA)), Morgan = c(rep(NA)),Summit = c(rep(NA)), Weber= c(rep(NA)),Dates = c(2015,2070,2150))

#Calculate Demand by County For 2015, 2070 and 2150

#2015
while (i<=6) {
  Demand_County[1,i] <- D2015ET_Same[i,3]*D2015ET_Same[i,4] +D2015ET_Same[i,3]*D2015ET_Same[i,5]
  i=i+1}

#2070
i=1
while (i<=6) {
  Demand_County[2,i] <- D2070ET_Same[i,3]*D2070ET_Same[i,4] +D2070ET_Same[i,3]*D2070ET_Same[i,5]
  i=i+1}

#2150
i=1
while (i<=6) {
  Demand_County[3,i] <- D2150ET_Same[i,3]*D2150ET_Same[i,4] +D2150ET_Same[i,3]*D2150ET_Same[i,5]
  i=i+1}

Demand_County


 #Conversion from Gallons per day to Acre-feet per year

  Demand_County <- Demand_County*0.0000030688832459704*365

  Demand_County[1:3,7]<-c(2015,2070,2150)

  Demand_County

 #Input Base Utah County Values

  Demand_County[1:3,1] <- c(rep(35500))
    Demand_County

  #Input Calculated Total County Demand
  DWRSA_Table$Counties <- c(Demand_County[1,1],Demand_County[1,5],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,4],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,3],Demand_County[1,3],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6])

  #Create a New Dataframe for Demand by Service Area
  Demand_SA_DD <- data.frame('2015' = c(1:19),'2070' = c(1:19),'2150' = c(1:19))


#Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

  #2015
  i=1
  while (i<=19) {
  Demand_SA_DD[i,1] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
  }

  #2070
  i=1
  year=2

  DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

  while (i<=19) {
  Demand_SA_DD[i,2] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
  }

  #2150
  year=3
  i=1

  DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

  while (i<=19) {
  Demand_SA_DD[i,3] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
  i=i+1
  }

#Outputs
  Demand_SA_ET_Same <- Demand_SA
  Demand_SA_D_ET_Same <- Demand_SA_D
  Demand_SA_DD_ET_Same <- Demand_SA_DD

#Output Same Per Capita Usage and Same ET Calculations for Change in AG Calculations
#Move into the output folder
   #setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Service Area Demand Scenarios/Output")
   #Move back to code directory
   setwd(fCodeDir)
   #Move into the local input directory
   setwd("../1 - Scenario Processing/Annual Service Area Demand Scenarios/Output")
   
   write.xlsx(Demand_SA_ET_Same, file = "MI_Same.xlsx")

#################################################################################################################################################################################################################################################################################################################################################################################################################################################
### ET Scenario c. Decreased Usage due to change in ET (-15% Outdoor Usage Case) ###
#################################################################################################################################################################################################################################################################################################################################################################################################################################################

    ##Calculate Per-Capita Demand Initial values

    #Create DataFrame
    i=1

    Demand_County <- data.frame(Utah= c(rep(NA)),Box_Elder = c(rep(NA)),Davis = c(rep(NA)), Morgan = c(rep(NA)),Summit = c(rep(NA)), Weber= c(rep(NA)),Dates = c(2015,2070,2150))

    #Calculate Demand by County For 2015, 2070 and 2150

    #2015
    while (i<=6) {
      Demand_County[1,i] <- D2015ET_Decrease[i,3]*D2015ET_Decrease[i,4] +D2015ET_Decrease[i,3]*D2015ET_Decrease[i,5]
      i=i+1}

    #2070
    i=1
    while (i<=6) {
      Demand_County[2,i] <- D2070ET_Decrease[i,3]*D2070ET_Decrease[i,4] +D2070ET_Decrease[i,3]*D2070ET_Decrease[i,5]
      i=i+1}

    #2150
    i=1
    while (i<=6) {
      Demand_County[3,i] <- D2150ET_Decrease[i,3]*D2150ET_Decrease[i,4] +D2150ET_Decrease[i,3]*D2150ET_Decrease[i,5]
      i=i+1}

    Demand_County

    #Conversion from Gallons per day to Acre-feet per year

    Demand_County <- Demand_County*0.0000030688832459704*365

    Demand_County[1:3,7]<-c(2015,2070,2150)
    Demand_County
    #Input Base Utah County Values
    Demand_County[1:3,1] <- c(rep(35500))
    Demand_County

    #Input Calculated Total County Demand
    DWRSA_Table$Counties <- c(Demand_County[1,1],Demand_County[1,5],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,4],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,3],Demand_County[1,3],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6])

    #Create a New Dataframe for Demand by Service Area
    Demand_SA <- data.frame('2015' = c(1:19),'2070' = c(1:19),'2150' = c(1:19))

    #Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

    ##vlookup
    #2015

    i=1
    while (i<=19) {
      Demand_SA[i,1] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
      i=i+1
    }

    #2070
    i=1
    year=2

    DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

    while (i<=19) {
      Demand_SA[i,2] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
      i=i+1
    }

    #2150
    year=3
    i=1

    DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

    while (i<=19) {
      Demand_SA[i,3] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
      i=i+1
    }

    MIDemand_SAbyPopulation <- Demand_SA

    #View(MIDemand_SAbyPopulation)

## #With PerCapita Percent Changes (Decrease Scenario)#####################################################################################################################################################################################
     #Change The Input by ScenarioSA_PcntChanges

    #Decrease the Potable Use by 10%
    #SC = Scenario Column (e.i. Same, Decrease, Increase, Drastic Decrease, Drastic Increase)

    SC = 4 # Decrease

    #2015
    i=2
    while (i<=6) {D2015ET_Decrease[i,4]<-D2015ET_Decrease[i,4]-(D2015ET_Decrease[i,4]*ScenarioSA_PCntChanges[1,SC])
    i=i+1
    }

    #2070
    i=2
    while (i<=6) {D2070ET_Decrease[i,4]<-D2070ET_Decrease[i,4]-(D2070ET_Decrease[i,4]*ScenarioSA_PCntChanges[1,SC])
    i=i+1
    }

    #2150
    i=2
    while (i<=6) {D2150ET_Decrease[i,4]<-D2150ET_Decrease[i,4]-(D2150ET_Decrease[i,4]*ScenarioSA_PCntChanges[1,SC])
    i=i+1
    }

    #Decrease the Secondary Use by 34% to make total PerCapita reduction 25%
    #2015
    i=2
    while (i<=6) {D2015ET_Decrease[i,5]<-D2015ET_Decrease[i,5]-(D2015ET_Decrease[i,5]*ScenarioSA_PCntChanges[2,SC])
    i=i+1
    }

    #2070
    i=2
    while (i<=6) {D2070ET_Decrease[i,5]<-D2070ET_Decrease[i,5]-(D2070ET_Decrease[i,5]*ScenarioSA_PCntChanges[2,SC])
    i=i+1
    }

    #2150
    i=2
    while (i<=6) {D2150ET_Decrease[i,5]<-D2150ET_Decrease[i,5]-(D2150ET_Decrease[i,5]*ScenarioSA_PCntChanges[2,SC])
    i=i+1
    }

    ##Calculate Per-Capita Demand Initial values

    #Create DataFrame
    i=1

    Demand_County <- data.frame(Utah= c(rep(NA)),Box_Elder = c(rep(NA)),Davis = c(rep(NA)), Morgan = c(rep(NA)),Summit = c(rep(NA)), Weber= c(rep(NA)),Dates = c(2015,2070,2150))

    #Calculate Demand by County For 2015, 2070 and 2150

    #2015
    while (i<=6) {
      Demand_County[1,i] <- D2015ET_Decrease[i,3]*D2015ET_Decrease[i,4] +D2015ET_Decrease[i,3]*D2015ET_Decrease[i,5]
      i=i+1}

    #2070
    i=1
    while (i<=6) {
      Demand_County[2,i] <- D2070ET_Decrease[i,3]*D2070ET_Decrease[i,4] +D2070ET_Decrease[i,3]*D2070ET_Decrease[i,5]
      i=i+1}

    #2150
    i=1
    while (i<=6) {
      Demand_County[3,i] <- D2150ET_Decrease[i,3]*D2150ET_Decrease[i,4] +D2150ET_Decrease[i,3]*D2150ET_Decrease[i,5]
      i=i+1}

    Demand_County


    #Conversion from Gallons per day to Acre-feet per year

    Demand_County <- Demand_County*0.0000030688832459704*365

    Demand_County[1:3,7]<-c(2015,2070,2150)

    Demand_County

    #Input Base Utah County Values

    Demand_County[1:3,1] <- c(rep(35500))
    Demand_County

    #Input Calculated Total County Demand
    DWRSA_Table$Counties <- c(Demand_County[1,1],Demand_County[1,5],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,4],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,3],Demand_County[1,3],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6])

    #Create a New Dataframe for Demand by Service Area
    Demand_SA_D <- data.frame('2015' = c(1:19),'2070' = c(1:19),'2150' = c(1:19))

    #Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

    #2015
    i=1
    while (i<=19) {
      Demand_SA_D[i,1] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
      i=i+1
    }

    #2070
    i=1
    year=2

    DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

    while (i<=19) {
      Demand_SA_D[i,2] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
      i=i+1
    }

    #2150
    year=3
    i=1

    DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

    while (i<=19) {
      Demand_SA_D[i,3] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
      i=i+1
    }

    #Demand_SA_D

###With Per Capita Percent Changes  (Drastic Decrease (DD))###########################################################################################################################################################################################################################################################


    #Change The Input by ScenarioSA_PcntChanges

    #Reset Values
    #1 & #2 Inputs By County and Year

    D2015ET_Decrease <- D2015
    D2015ET_Decrease$Secondary.Use <- D2015ET_Decrease$Secondary.Use * ChangeinUsage_ET_DecreaseFactor

    D2070ET_Decrease <- D2070
    D2070ET_Decrease$Secondary.Use <- D2070ET_Decrease$Secondary.Use * ChangeinUsage_ET_DecreaseFactor

    D2150ET_Decrease <- D2150
    D2150ET_Decrease$Secondary.Use <- D2150ET_Decrease$Secondary.Use * ChangeinUsage_ET_DecreaseFactor
    #SC = Scenario Column (e.i. Same, Decrease, Increase, Drastic Decrease, Drastic Increase)

    SC = 6 #Drastic Decrease

    #Decrease the Potable Use by 20%

    #2015
    i=2
    while (i<=6) {D2015ET_Decrease[i,4]<-D2015ET_Decrease[i,4]-(D2015ET_Decrease[i,4]*ScenarioSA_PCntChanges[1,SC])
    i=i+1
    }

    #2070
    i=2
    while (i<=6) {D2070ET_Decrease[i,4]<-D2070ET_Decrease[i,4]-(D2070ET_Decrease[i,4]*ScenarioSA_PCntChanges[1,SC])
    i=i+1
    }

    #2150
    i=2
    while (i<=6) {D2150ET_Decrease[i,4]<-D2150ET_Decrease[i,4]-(D2150ET_Decrease[i,4]*ScenarioSA_PCntChanges[1,SC])
    i=i+1
    }

    #Decrease the Secondary Use by 44%
    #2015
    i=2
    while (i<=6) {D2015ET_Decrease[i,5]<-D2015ET_Decrease[i,5]-(D2015ET_Decrease[i,5]*ScenarioSA_PCntChanges[2,SC])
    i=i+1
    }

    #2070
    i=2
    while (i<=6) {D2070ET_Decrease[i,5]<-D2070ET_Decrease[i,5]-(D2070ET_Decrease[i,5]*ScenarioSA_PCntChanges[2,SC])
    i=i+1
    }

    #2150
    i=2
    while (i<=6) {D2150ET_Decrease[i,5]<-D2150ET_Decrease[i,5]-(D2150ET_Decrease[i,5]*ScenarioSA_PCntChanges[2,SC])
    i=i+1
    }

    ##Calculate Per-Capita Demand Initial values

    #Create DataFrame
    i=1
    Demand_County <- data.frame(Utah= c(rep(NA)),Box_Elder = c(rep(NA)),Davis = c(rep(NA)), Morgan = c(rep(NA)),Summit = c(rep(NA)), Weber= c(rep(NA)),Dates = c(2015,2070,2150))

    #Calculate Demand by County For 2015, 2070 and 2150

    #2015
    while (i<=6) {
      Demand_County[1,i] <- D2015ET_Decrease[i,3]*D2015ET_Decrease[i,4] +D2015ET_Decrease[i,3]*D2015ET_Decrease[i,5]
      i=i+1}

    #2070
    i=1
    while (i<=6) {
      Demand_County[2,i] <- D2070ET_Decrease[i,3]*D2070ET_Decrease[i,4] +D2070ET_Decrease[i,3]*D2070ET_Decrease[i,5]
      i=i+1}

    #2150
    i=1
    while (i<=6) {
      Demand_County[3,i] <- D2150ET_Decrease[i,3]*D2150ET_Decrease[i,4] +D2150ET_Decrease[i,3]*D2150ET_Decrease[i,5]
      i=i+1}

    Demand_County


    #Conversion from Gallons per day to Acre-feet per year

    Demand_County <- Demand_County*0.0000030688832459704*365

    Demand_County[1:3,7]<-c(2015,2070,2150)

    Demand_County

    #Input Base Utah County Values

    Demand_County[1:3,1] <- c(rep(35500))
    Demand_County

    #Input Calculated Total County Demand
    DWRSA_Table$Counties <- c(Demand_County[1,1],Demand_County[1,5],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,4],Demand_County[1,5],Demand_County[1,4],Demand_County[1,4],Demand_County[1,3],Demand_County[1,3],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6],Demand_County[1,6])

    #Create a New Dataframe for Demand by Service Area
    Demand_SA_DD <- data.frame('2015' = c(1:19),'2070' = c(1:19),'2150' = c(1:19))


    #Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

    #2015
    i=1
    while (i<=19) {
      Demand_SA_DD[i,1] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
      i=i+1
    }

    #2070
    i=1
    year=2

    DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

    while (i<=19) {
      Demand_SA_DD[i,2] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
      i=i+1
    }

    #2150
    year=3
    i=1

    DWRSA_Table$Counties <- c(Demand_County[year,1],Demand_County[year,5],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,4],Demand_County[year,5],Demand_County[year,4],Demand_County[year,4],Demand_County[year,3],Demand_County[year,3],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6],Demand_County[year,6])

    while (i<=19) {
      Demand_SA_DD[i,3] <- DWRSA_Table[i,8]*(DWRSA_Table[i,4]/DWRSA_Table[i,7])
      i=i+1
    }

#Outputs
      Demand_SA_ET_Decrease <- Demand_SA
      Demand_SA_D_ET_Decrease <- Demand_SA_D
      Demand_SA_DD_ET_Decrease <- Demand_SA_DD


#################################################################################################################################################################################################################################################################################################################################################################################################################################################
### Compilation of MI Data ###
#################################################################################################################################################################################################################################################################################################################################################################################################################################################

 #View Data
  #Scenarios
    S0<-  Demand_SA_ET_Same
    S1<-  Demand_SA_D_ET_Same
    S2<-  Demand_SA_DD_ET_Same

    S3<-  Demand_SA_ET_Decrease
    S4<-  Demand_SA_D_ET_Decrease
    S5<-  Demand_SA_DD_ET_Decrease

    S6<-  Demand_SA_ET_Increase
    S7<-  Demand_SA_D_ET_Increase
    S8<-  Demand_SA_DD_ET_Increase


Scenarios <- data.frame(S0,S1,S2,S3,S4,S5,S6,S7,S8)

#Add a row to the Scenarios dataframe for SA20 values are 0
Scenarios[20,] = c(rep(0))

  #MI_Sums
SS0<-  colSums(Demand_SA_ET_Same)
SS1<-  colSums(Demand_SA_D_ET_Same)
SS2<-  colSums(Demand_SA_DD_ET_Same)

SS3<-  colSums(Demand_SA_ET_Decrease)
SS4<-  colSums(Demand_SA_D_ET_Decrease)
SS5<-  colSums(Demand_SA_DD_ET_Decrease)

SS6<-  colSums(Demand_SA_ET_Increase)
SS7<-  colSums(Demand_SA_D_ET_Increase)
SS8<-  colSums(Demand_SA_DD_ET_Increase)

SummedScenarios <- data.frame(SS0,SS1,SS2,SS3,SS4,SS5,SS6,SS7,SS8)

SummedScenarios


#################################################################################################################################################################################################################################################################################################################################################################################################################################################
### Plots ###
#################################################################################################################################################################################################################################################################################################################################################################################################################################################
#Pie

LabelSA = DWRSA_Table$Description

plot_ly(data =Demand_SA,labels = LabelSA, values=Demand_SA$X2015 ,type = "pie",domain = list(x =c(0,1/3),y=c(0,1))) %>%
  add_trace(data =Demand_SA ,labels = LabelSA, values=Demand_SA$X2070,type = "pie",domain =list(x=c(1/3,2/3),y=c(0,1)))%>%
  add_trace(data =Demand_SA ,labels = LabelSA, values=Demand_SA$X2150,type = "pie",domain =list(x=c(2/3,1),y=c(0,1)))


  ## BarPlots without Agriculture

Dates <- c("2015", "2070", "2150")

plot_ly(data = SummedScenarios,x = ~Dates,y= ~SS0 ,type = 'bar', name = 'SS0' ) %>%
add_trace(y = ~SummedScenarios$SS1,name = 'SS1') %>%
add_trace(y = ~SummedScenarios$SS2,name = 'SS2') %>%
add_trace(y = ~SummedScenarios$SS3,name = 'SS3') %>%
add_trace(y = ~SummedScenarios$SS4,name = 'SS4') %>%
add_trace(y = ~SummedScenarios$SS5,name = 'SS5') %>%
add_trace(y = ~SummedScenarios$SS6,name = 'SS6') %>%
add_trace(y = ~SummedScenarios$SS7,name = 'SS7') %>%
add_trace(y = ~SummedScenarios$SS8,name = 'SS8') %>%
layout(yaxis=list(title = 'M&I Demand (acre-feet)',barmode = 'group'))


 ##BarPlots with Agriculture  -- Only 2015 So Far #

# Move to correct directory
#setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Service Area Demand Scenarios/Input_Data")
#Move back to code directory
setwd(fCodeDir)
#Move into the local input directory
setwd("../1 - Scenario Processing/Annual Service Area Demand Scenarios/Input_Data")


MIAg2015 <- read_excel("MIAG2015.xlsx")

MIAG_2015Summed <- colSums(MIAg2015)

xnotation <-  c("SameET 2015","SameET D2015","SameET DD2015","DecET 2015","DecET D2015","DecET DD2015","IncET 2015","IncET D2015","IncET DD2015")
xnotation <-  c("SS0","SS1","SS2","SS3","SS4","SS5","SS6","SS7","SS8")


MIAg2015Summed <- data.frame(xnotation,MIAG_2015Summed)

plot_ly(data = MIAg2015Summed,x =xnotation,y= MIAG_2015Summed ,type = 'bar', name = '2015') %>%
layout(yaxis = list(barmode = 'group'))


###############################################################################################################################################
## Output Municipal Demand
###############################################################################################################################################

#Move to correct directory
#setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Service Area Demand Scenarios/Output")
#Move back to code directory
setwd(fCodeDir)
#Move into the local input directory
setwd("../1 - Scenario Processing/Annual Service Area Demand Scenarios/Output")

#Input How Many Scenarios

RunNumber <- 27

#Create Workbook

wb <- createWorkbook("Data")

#Create Worksheet for each Run

for(Num in 0:(RunNumber-1)) {
  RunsString <- paste0("Run",Num)
  addWorksheet(wb, RunsString)
  }

#writeData
  i=1
    while (i<=RunNumber) {
      writeData(wb,sheet = i, Scenarios[,i])
    i=i+1
  }

##Save workbook
    saveWorkbook(wb,"MI.xlsx",overwrite = TRUE)

  ###Save Scenarios###
    write.xlsx(Scenarios,"Scenarios.xlsx")

#Return to the code directory
setwd(fCodeDir)