# *------------------------------------------------------------------
# | PROGRAM NAME: Approximated Agricultural Demand
# | FILE NAME: Demand_CalcbyServiceArea--Agricultural
# | DATE: 06/05/19
# | CREATED BY:  Jacob Everitt
# *----------------------------------------------------------------
# | PURPOSE:  Develop understanding for Sedimentation selection
# |
# |
# |
# *------------------------------------------------------------------
# | STEPS:
# |  0:
# |  1:
# |  2:
# |  3:
# |  4:
# |  5:
# |  6:
# |  7:
# |  8:
# |  9:
# |  10:
# |
# |*------------------------------------------------------------------.
# | DATA USED:
# |
# |

# |*------------------------------------------------------------------
# | CONTENTS:
# |  Part 0:
# |  PART 1:
# |  PART 2:
# |  PART 3:
# *-----------------------------------------------------------------
# | UPDATES:
# |
# |
# *------------------------------------------------------------------
### Clear any existing data or functions.
rm(list=ls())
#input data
setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Sedimentation Numbers")
library(readxl)
library(dplyr)

MinandMax_Reservoir_Storage <- read_excel("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Sedimentation Numbers/MinandMax Reservoir Storage.xlsx")
#View(MinandMax_Reservoir_Storage)

#Sum Small, medium and large reserviors and Total reserviors
Small_Reserviors<-filter(MinandMax_Reservoir_Storage,MinandMax_Reservoir_Storage$`Reservior Size`=="sm")
Medium_Reserviors<-filter(MinandMax_Reservoir_Storage,MinandMax_Reservoir_Storage$`Reservior Size`=="md")
Large_Reserviors<-filter(MinandMax_Reservoir_Storage,MinandMax_Reservoir_Storage$`Reservior Size`=="lg")

Sum_Small_Reserviors<-sum(Small_Reserviors$`Max Volume (ac-ft)`)
Sum_Medium_Reserviors<-sum(Medium_Reserviors$`Max Volume (ac-ft)`)
Sum_Large_Reserviors<-sum(Large_Reserviors$`Max Volume (ac-ft)`)

sm<-Sum_Small_Reserviors
md<-Sum_Medium_Reserviors
lg<-Sum_Large_Reserviors
Tot<-sum(sm,md,lg)


#Percent Iterations
Percent_Change = 5
Change_per_Reservior_Size =1+(100/Percent_Change)
Total_Number= Change_per_Reservior_Size*Change_per_Reservior_Size*Change_per_Reservior_Size
#Reservoir_Percent_Table_bySize -> RPTS

RPTS <- data.frame(1:Total_Number)
x=1
i=100
c=Percent_Change

#Row 2
while (x<= Total_Number) {
  while (i>=0) {
    RPTS[x,2] <- i
    i=i-c
    x=x+1  
  }
  i=100
}


x=1
i=100
y=1
z=Change_per_Reservior_Size

#Row 3
while (x<= (Total_Number/Change_per_Reservior_Size)) {
  while (i>=0) {
    RPTS[(y:z),3] <- rep(i)
    y= y+Change_per_Reservior_Size
    z= z+Change_per_Reservior_Size
    i=i-c
    x=x+1  
  }
  i=100
}

x=1
i=100
y=1
z=Change_per_Reservior_Size*Change_per_Reservior_Size

#Row 4
while (x<= (Change_per_Reservior_Size)) {
  while (i>=0) {
    RPTS[(y:z),4] <- rep(i)
    y= y+(Change_per_Reservior_Size*Change_per_Reservior_Size)
    z= z+(Change_per_Reservior_Size*Change_per_Reservior_Size)
    i=i-c
    x=x+1  
  }
  i=100
}


#Label Columns

colnames(RPTS)<-c("Number","sm","md","lg")
pt<-RPTS/100

#Row 5
  RPTS[,5] <- ((sm*pt[,2])+(md*pt[,3])+(lg*pt[,4]))/Tot

  
#Plot  
library(plotly)
  
  trace_0 <- RPTS[,2]
  trace_1 <- RPTS[,3]
  trace_2 <- RPTS[,4]
  x <- (RPTS[,5])*100
  
  data <- data.frame(x, trace_0, trace_1, trace_2)
  
  fig <- plot_ly(data, x = ~x, y = ~trace_0, name = 'Small', type = 'scatter', mode = 'markers') 
  fig <- fig %>% add_trace(y = ~trace_1, name = 'Medium', mode = 'markers') 
  fig <- fig %>% add_trace(y = ~trace_2, name = 'Large', mode = 'markers')
  fig <- fig %>% layout(title = "Sedimentation Effect on Reservior Storage",
             xaxis = list(title = "Percentage of All Reservoirs Lost"),
             yaxis = list (title = "Percentage of Small, Medium and Large Reservoirs Lost"))
  fig
  
  
  
  # filter  
  trace_0 <- RPTS[,2]
  trace_1 <- RPTS[,3]
  trace_2 <- RPTS[,4]
  x <- (RPTS[,5])*100
  
  data <- data.frame(x, trace_0, trace_1, trace_2)
  
  fig <- plot_ly(data, x = ~x, y = ~trace_0, name = 'Small', type = 'scatter', mode = 'markers') 
  fig <- fig %>% add_trace(y = ~trace_1, name = 'Medium', mode = 'markers') 
  fig <- fig %>% add_trace(y = ~trace_2, name = 'Large', mode = 'markers')
  fig <- fig %>% layout(title = "Sedimentation Effect on Reservior Storage",
                        xaxis = list(title = "Percentage of All Reservoirs Lost"),
                        yaxis = list (title = "Percentage of Small, Medium and Large Reservoirs Lost"))
  fig
  
  
    
  ## Parallel PLOT
  
  library(plotly)
  
  fig <- plot_ly(type = 'parcoords', line = list(color = 'blues9'),
                 dimensions = list(
                   list(range = c(0,100),
                        constraintrange = c(0,100),
                        label = 'Small (0 - 20K ac-ft)', values = trace_0),
                   list(range = c(0,100),
                        constraintrange = c(0,50),
                        label = 'Medium (20K - 100K ac-ft)', values = trace_1),
                   list(range = c(0,100),
                        constraintrange = c(0,10),
                        label = 'Large (100K ac-ft +) ', values = trace_2),
                   list(range = c(0,100),
                        label = 'Total', values = x)
                 )
                   )
  fig<- fig%>% layout(title = "Percent Storage Lost due to Sedimentation in Weber Basin Reserviors",
                      yaxis = list(title = "Percentage of All Reservoirs Lost"),
                      xaxis = list (title = "Percentage of Small, Medium and Large Reservoirs Lost"))
  
  fig
  
  ##PDF 
  
  library(gridExtra)
  pdf("Reserviors.pdf", height=18, width=33)
  grid.table(MinandMax_Reservoir_Storage)
  dev.off()
