#Iterate Flows in yearly segments of Average annual#######
#For the selection of Streamflow inputs into the Model

### Clear any existing data or functions.
#rm(list=ls())

#Store the current code directory so we can later return (0 - Code)
fCodeDir <- getwd()
## Move into local directory ######################################################################################################
setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Average Streamflow Scenario Selection")
#setwd("../1 - Scenario Processing/Annual Average Streamflow Scenario Selection")

#Input Librarys###############################################
library("viridisLite")
library(readr)
library(tidyverse)
library(readxl)
#install.packages("measurements")
library(measurements)
#Data######################################
weber2014 <- read_csv("weber2014_ac-ft.csv")  #Annual Data from Paleo Flows and Observed Flows
#View(weber2014)                              ## Note that the Data frame column names state the values are in m^3/s but values are in acre-feet/yr

#quick plot

plot(weber2014$year,weber2014$recon_m3s,main = "Reconstructed Paleo Flows")

ClimateFlowsWeberRiver <- read_excel("ClimateFlowsWeberRiver.xlsx")  # Monthly Data from Western Water A. Climate Scenarios
#View(ClimateFlowsWeberRiver)

ClimateFlowsWeberRiver <- ClimateFlowsWeberRiver[4:351,1:6]  #Get rid of first 3 months to start data on 1981-01-01

        data <- as_tibble(ClimateFlowsWeberRiver)   ## Used for Plots at bottom of code.
        SumsofClimate <- c(1:29)  ##bottom plots

df1 <- data.frame(ClimateFlowsWeberRiver) # Convert to dataframe

i=1981
j=1
YEARS <- c(1:348)
while (i<=2009) {
  YEARS[(j:(j+11))] <- rep(i,12)          #Create Year Column 1981 to 2009
  j=j+12
  i=i+1
  }

df1$year <- YEARS

#View(df1)
#Convert Monthly Data to Yearly data
      #rename columns
names(df1)[1]<-paste("Date")
names(df1)[2]<-paste("StreamflowHistorical")
names(df1)[3]<-paste("StreamflowWW")
names(df1)[4]<-paste("StreamflowWD")
names(df1)[5]<-paste("StreamflowHW")
names(df1)[6]<-paste("StreamflowHD")
names(df1)[7]<-paste("Year")

  library(dplyr)
#WWA Annual Climate Change Streamflows
  Historical <-  data.frame(df1 %>% group_by(df1$Year) %>% summarise(StreamflowHistorical = sum(StreamflowHistorical)))
  WarmWet  <-  data.frame(df1 %>% group_by(df1$Year) %>% summarise(StreamflowWW = sum(StreamflowWW)))
  WarmDry <- data.frame(df1 %>% group_by(df1$Year) %>% summarise(StreamflowWD = sum(StreamflowWD)))
  HotWet <-  data.frame(df1 %>% group_by(df1$Year) %>% summarise(StreamflowHW = sum(StreamflowHW)))
  HotDry <-  data.frame(df1 %>% group_by(df1$Year) %>% summarise(StreamflowHD = sum(StreamflowHD)))

  ACF0 <-merge(Historical,WarmWet, by = "df1.Year")     #Combine Climate Change Streamflows
  ACF1 <-merge(ACF0,WarmDry,by = "df1.Year")
  ACF2 <-merge(ACF1,HotWet,by = "df1.Year")
  Annual_Flows <-merge(ACF2,HotDry,by = "df1.Year")

  #quick plots
  x= c(1905:2019)
  y=na.omit(weber2014$obs_m3s)  # X and Y data for observed data from Gage -- Paleo Data
  par(mfrow=c(2,3))
  plot(x,y,main = "Observed",xlab ="Year",ylab="Streamflows (Acre-Feet/Year)" )
  plot(Annual_Flows$df1.Year,Annual_Flows$StreamflowHistorical,main="Historical",xlab = "Year",ylab = "Streamflows (Acre-Feet/Year)")
  plot(Annual_Flows$df1.Year,Annual_Flows$StreamflowWW,main="WarmWet",xlab = "Year",ylab = "Streamflows (Acre-Feet/Year)")
  plot(Annual_Flows$df1.Year,Annual_Flows$StreamflowWD,main="WarmDry",xlab = "Year",ylab = "Streamflows (Acre-Feet/Year)")
  plot(Annual_Flows$df1.Year,Annual_Flows$StreamflowHW,main="HotWet",xlab = "Year",ylab = "Streamflows (Acre-Feet/Year)")
  plot(Annual_Flows$df1.Year,Annual_Flows$StreamflowHD,main="HotDry",xlab = "Year",ylab = "Streamflows (Acre-Feet/Year)")

  #Seperate Paleo data into 29 Year Increments and Add to Annual_Flows Data Frame
  #See Plots below of 1-60 year increments #Matches other data

  i=1
  j=1
  k=j+28
  while (i<=20) {
   Annual_Flows[,paste("PaleoFlows",i,sep=" ")] =weber2014[j:k,8]
    i=i+1
    j=j+29
    k=j+28
  }

  #add Observed Data from Paleo data from to Annual_Flows Data Frame

  i=1
  j=477
  k=j+28
  while (i<=4) {
    Annual_Flows[,paste("ObservedFlows",i,sep=" ")] =weber2014[j:k,7]
    i=i+1
    j=j+29
    k=j+28
  }

  #Rename PaleoFlows and ObservedFlows Columns
  names(Annual_Flows)[1]<-paste("Date")
  names(Annual_Flows)[7]<-paste("Paleo 1429-1457")
  names(Annual_Flows)[8]<-paste("Paleo 1458-1486")
  names(Annual_Flows)[9]<-paste("Paleo 1487-1515")
  names(Annual_Flows)[10]<-paste("Paleo 1516-1544")
  names(Annual_Flows)[11]<-paste("Paleo 1545-1573")
  names(Annual_Flows)[12]<-paste("Paleo 1574-1602")
  names(Annual_Flows)[13]<-paste("Paleo 1603-1631")
  names(Annual_Flows)[14]<-paste("Paleo 1632-1660")
  names(Annual_Flows)[15]<-paste("Paleo 1661-1689")
  names(Annual_Flows)[16]<-paste("Paleo 1690-1718")
  names(Annual_Flows)[17]<-paste("Paleo 1719-1747")
  names(Annual_Flows)[18]<-paste("Paleo 1748-1776")
  names(Annual_Flows)[19]<-paste("Paleo 1777-1805")
  names(Annual_Flows)[20]<-paste("Paleo 1806-1834")
  names(Annual_Flows)[21]<-paste("Paleo 1835-1863")
  names(Annual_Flows)[22]<-paste("Paleo 1864-1892")
  names(Annual_Flows)[23]<-paste("Paleo 1893-1921")
  names(Annual_Flows)[24]<-paste("Paleo 1922-1950")
  names(Annual_Flows)[25]<-paste("Paleo 1951-1979")
  names(Annual_Flows)[26]<-paste("Paleo 1980-2004")
  names(Annual_Flows)[27]<-paste("Observed 1905-1933")
  names(Annual_Flows)[28]<-paste("Observed 1934-1962")
  names(Annual_Flows)[29]<-paste("Observed 1963-1991")
  names(Annual_Flows)[30]<-paste("Observed 1992-2019")
#View(Annual_Flows)

#Quick plots
par(mfrow=c(2,3))

#points xy
#for(i in c(2:30)){
#plot(Annual_Flows[,1],Annual_Flows[,i],main=colnames(Annual_Flows)[i],xlab = "Year",ylab = "Streamflows (Acre-Feet/Year)")
#}
#line xy
for(i in c(2:30)){
  plot(Annual_Flows[,1],Annual_Flows[,i],type = "o",main=colnames(Annual_Flows)[i],xlab = "Year",ylab = "Streamflows (Acre-Feet/Year)")
}

#Plot all plots on one Graph
library(plotly)

p<- plot_ly(Annual_Flows, x = Annual_Flows$Date, name = 'Year', type = 'scatter', mode = 'lines',
            line = list(color = colors(distinct = F), width = 2)) %>%
  layout(#title = "Title",
    xaxis = list(title ="Time"),
    yaxis = list(title = "Streamflow (Acre-Ft/Yr)"))

for(trace in colnames(Annual_Flows)){
  p <- p %>% plotly::add_trace(y = as.formula(paste0("~`",trace,"`")),name = trace)
}
p

plot_ly(x=HotDry$df1.Year,y=HotDry$StreamflowHD,type="scatter",mode ='lines',
        line = list(color ="black",width=1)) %>%
        layout(#title ="Title",
          xaxis=list(title="Annual_Recon"),
          yaxis =list(title ="Annual Mean Discharge(ac-ft)"))


  #METRICS

  # 1-Mean  ->   Linear Average looking forward
                #Quartile Means
                          # - Bottom 25%
                          # - Top 25%
  #2- Drought Duration

  #3- Drought Intensity

SummaryAnnualFlows <- summary(na.omit(Annual_Flows))
#View(SummaryAnnualFlows)


  ##Apply Metrics

#1-Mean

MeanAnnual_Flows<- mean(Annual_Flows[,2])  #Create Dataframe
MeanAnnual_Fl0ws<- mean(Annual_Flows[,2])  #Create Dataframe nontransposed

for (i in 1:29) {
  MeanAnnual_Flows[i]<- mean(na.omit(Annual_Flows[,(i+1)]))
}

for (i in 1:29) {
  MeanAnnual_Fl0ws[i]<- mean(na.omit(Annual_Flows[,(i+1)]))  #Nontranposed
}

  #View(MeanAnnual_Flows)
MeanAnnual_Flows<- data.frame(t(MeanAnnual_Flows))  #Transpose

names(MeanAnnual_Flows)[1:29]<-colnames(Annual_Flows[,2:30]) #Rename Columns

  #plot in linear vertical lines
  p<- plot_ly(MeanAnnual_Flows, x = 1:29, name = 'Year', type = 'scatter', mode = 'lines',
            line = list(color = colors(distinct = F), width = 2)) %>%
  layout(#title = "Title",
    xaxis = list(title =""),
    yaxis = list(title = "Streamflow (Acre-Ft/Yr)"))

  for(trace in colnames(MeanAnnual_Flows)){
  p <- p %>% plotly::add_trace(y = as.formula(paste0("~`",trace,"`")),name = trace)
  }
  p

  #1B-- Bottom 25% Quartile
  Bottom25Annual_Flows<- quantile(na.omit(Annual_Flows[,2]),probs = 25/100)  #Create Dataframe
  Bottom25Annual_Fl0ws<- quantile(na.omit(Annual_Flows[,2]),probs = 25/100)  #Create Dataframe nontransposed

  for (i in 1:29) {
    Bottom25Annual_Flows[i]<- quantile(na.omit(Annual_Flows[,(i+1)]),probs = 25/100)
    Bottom25Annual_Fl0ws[i]<- quantile(na.omit(Annual_Flows[,(i+1)]),probs = 25/100) #Nontransposed

    }
  #View(Bottom25Annual_Flows)
Bottom25Annual_Flows<- data.frame(t(Bottom25Annual_Flows))  #Transpose
names(Bottom25Annual_Flows)[1:29]<-colnames(Annual_Flows[,2:30]) #Rename Columns
  #View(Bottom25Annual_Flows)


#plot in linear vertical lines
p<- plot_ly(Bottom25Annual_Flows, x = 1:29, name = 'Year', type = 'scatter', mode = 'lines',
            line = list(color = colors(distinct = F), width = 2)) %>%
  layout(#title = "Title",
    xaxis = list(title =""),
    yaxis = list(title = "Streamflow (Acre-Ft/Yr)"))

for(trace in colnames(Bottom25Annual_Flows)){
  p <- p %>% plotly::add_trace(y = as.formula(paste0("~`",trace,"`")),name = trace)
}
p

#1C--Top 25% Quartile
Top25Annual_Flows<- quantile(na.omit(Annual_Flows[,2]),probs = 75/100)  #Create Dataframe
Top25Annual_Fl0ws<- quantile(na.omit(Annual_Flows[,2]),probs = 75/100)  #Create Dataframe
for (i in 1:29) {
  Top25Annual_Flows[i]<- quantile(na.omit(Annual_Flows[,(i+1)]),probs = 75/100)
}
for (i in 1:29) {
  Top25Annual_Fl0ws[i]<- quantile(na.omit(Annual_Flows[,(i+1)]),probs = 75/100)
}
  #View(Top25Annual_Flows)
Top25Annual_Flows<- data.frame(t(Top25Annual_Flows))  #Transpose
names(Top25Annual_Flows)[1:29]<-colnames(Annual_Flows[,2:30]) #Rename Columns
  #View(Top25Annual_Flows)

#plot in linear vertical lines
p<- plot_ly(Top25Annual_Flows, x = 1:29, name = 'Year', type = 'scatter', mode = 'lines',
            line = list(color = colors(distinct = F), width = 2)) %>%
  layout(#title = "Title",
    xaxis = list(title =""),
    yaxis = list(title = "Streamflow (Acre-Ft/Yr)"))

for(trace in colnames(Top25Annual_Flows)){
  p <- p %>% plotly::add_trace(y = as.formula(paste0("~`",trace,"`")),name = trace)
}
p


###  Parallel Plots

Pp <- plot_ly(type = 'parcoords', line = list(color = 'blue'),
            dimensions = list(
              list(range =c(90000,180000),
                constraintrange = c(90000,100000),
                label = 'Mean Streamflow', values = c(MeanAnnual_Fl0ws)),
              list(range = c(65000,155000),
                   label = 'Bottom 25% Streamflow', values = c(Bottom25Annual_Fl0ws)) ,
              list(range = c(122000,212000),
                   label = 'Top 25% Streamflow', values = c(Top25Annual_Fl0ws))
              )
  )
Pp



#2-



#Parallel Plots with Each  Metric

########---------------------------- Pre 29 year Selection----- ##OLD Code---------------------------------
#Convert monthly climate data to annual climate data
i=1
j=1
k=2
while (k<=6) {
  while (i<=348) {
    SumsofClimate[j] <- sum(data[i:(i+11),k])
    i=i+12
    j=j+1
  }
  i=1
  k=k+1
}

#Add data
weber2014 <- add_row(weber2014, X1 = 592:736,col_name = 'weber2014' ,year = 2020:2164, month = 1:1, recon_m3s = SumsofClimate, resolution = "annual" )
weber2014[577:591,8] <- weber2014[577:591,7]

#average specified yearly increments######################
#Weber_Annualflow <- weber2014$recon_m3s  #with climate data

#with no climate data
weber2014 <- read_csv("weber2014_ac-ft.csv")
weber2014[577:591,8] <- weber2014[577:591,7]
Weber_Annualflow <- weber2014$recon_m3s
#-Iteration-----------------------------------------------------------------
num_years <- 591
y=1
acft<-c(1:num_years)
acft <- data.frame(acft)
while (y<=60) {
  i=1
  L=y-1

  while (i<=num_years) {
    acft[i,y] <- mean(Weber_Annualflow[i:(i+L)])
    i=i+1
  }
  data.frame(acft)
  y=y+1
}

#view(acft)
#-Rename colums-----------------------------------------------------------

names(acft) <- gsub("V","Length of Years ",names(acft))
names(acft) <- sub("acft","Length of Years 1",names(acft))

#-Insert Years-------------------------------------------------------------

acft$years <- weber2014$year

#-PLOTS#--------------------------------------------------------------------
library("plotly", lib.loc="~/R/win-library/3.5")

#boxplots
pb <- plot_ly(acft, y = acft$`Length of Years 1`,x=1, type = "box",name='1 Year') %>%
  #add_trace(y=acft$`Length of Years 2`, x=2,name='2 Year')%>%
  #add_trace(y=acft$`Length of Years 3`, x=3,name='3 Year')%>%
  #add_trace(y=acft$`Length of Years 4`, x=4,name='4 Year')%>%
  add_trace(y=acft$`Length of Years 5`, x=5,name='5 Year')%>%
  #add_trace(y=acft$`Length of Years 6`, x=6,name='6 Year')%>%
  #add_trace(y=acft$`Length of Years 7`, x=7,name='7 Year')%>%
  #add_trace(y=acft$`Length of Years 8`, x=8,name='8 Year')%>%
  #add_trace(y=acft$`Length of Years 9`, x=9,name='9 Year')%>%
  add_trace(y=acft$`Length of Years 10`, x=10,name='10 Year')%>%
  add_trace(y=acft$`Length of Years 15`, x=15,name='15 Year')%>%
  add_trace(y=acft$`Length of Years 20`, x=20,name='20 Year')%>%
  add_trace(y=acft$`Length of Years 25`, x=25,name='25 Year')%>%
  add_trace(y=acft$`Length of Years 30`, x=30,name='30 Year')%>%
  add_trace(y=acft$`Length of Years 35`, x=35,name='35 Year')%>%
  add_trace(y=acft$`Length of Years 40`, x=40,name='40 Year')%>%
  add_trace(y=acft$`Length of Years 45`, x=45,name='45 Year')%>%
  add_trace(y=acft$`Length of Years 50`, x=50,name='50 Year')%>%
  add_trace(y=acft$`Length of Years 55`, x=55,name='55 Year')%>%
  add_trace(y=acft$`Length of Years 60`, x=60,name='60 Year')%>%
  layout(title='Forward Looking_Linear Average Annual Flow')

pb

#scatterplots----
    #Data Labels on Hover this link: https://plot.ly/r/line-and-scatter/
ps <- plot_ly(acft, y = acft$`Length of Years 1`,x = 1, type ="scatter",
  name = "1 Year Average Annual", text = ~paste("Year:",acft$years) )%>%
  #add_trace(y=acft$`Length of Years 2`, x=2, name = "2 Year Average Annual")%>%
  #add_trace(y=acft$`Length of Years 3`, x=3, name = "3 Year Average Annual")%>%
  #add_trace(y=acft$`Length of Years 4`, x=4, name = "4 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 5`, x=5, name = "5 Year Average Annual")%>%
  #add_trace(y=acft$`Length of Years 6`, x=6, name = "6 Year Average Annual")%>%
  #add_trace(y=acft$`Length of Years 7`, x=7, name = "7 Year Average Annual")%>%
  #add_trace(y=acft$`Length of Years 8`, x=8, name = "8 Year Average Annual")%>%
  #add_trace(y=acft$`Length of Years 9`, x=9, name = "9 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 10`, x=10, name = "10 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 15`, x=15, name = "15 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 20`, x=20, name = "20 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 25`, x=25, name = "25 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 30`, x=30, name = "30 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 35`, x=35, name = "35 Year Average Annual") %>%
  add_trace(y=acft$`Length of Years 40`, x=40, name = "40 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 45`, x=45, name = "45 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 50`, x=50, name = "50 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 55`, x=55, name = "55 Year Average Annual")%>%
  add_trace(y=acft$`Length of Years 60`, x=60, name = "60 Year Average Annual")%>%
layout(title = 'Forward Looking_Linear Average Annual Flow')
ps


ps <- plot_ly(acft, y = acft$`Length of Years 1`,x = '1 Year',color = acft$years ,type = "scatter",name='1 Year Annual Average')%>%
  #add_trace(y=acft$`Length of Years 2`, x='2 Year')%>%
  #add_trace(y=acft$`Length of Years 3`, x='3 Year')%>%
  #add_trace(y=acft$`Length of Years 4`, x='4 Year')%>%
  #add_trace(y=acft$`Length of Years 5`, x='5 Year')%>%
  #add_trace(y=acft$`Length of Years 6`, x='6 Year')%>%
  #add_trace(y=acft$`Length of Years 7`, x='7 Year')%>%
  #add_trace(y=acft$`Length of Years 8`, x='8 Year')%>%
  #add_trace(y=acft$`Length of Years 9`, x='9 Year')%>%
  add_trace(y=acft$`Length of Years 10`, x='10 Year',name='10 Year Annual Average')%>%
  #add_trace(y=acft$`Length of Years 11`, x='11 Year')%>%
  #add_trace(y=acft$`Length of Years 12`, x='12 Year')%>%
  #add_trace(y=acft$`Length of Years 13`, x='13 Year')%>%
  #add_trace(y=acft$`Length of Years 14`, x='14 Year')%>%
  #add_trace(y=acft$`Length of Years 15`, x='15 Year')%>%
  #add_trace(y=acft$`Length of Years 16`, x='16 Year')%>%
  #add_trace(y=acft$`Length of Years 17`, x='17 Year')%>%
  #add_trace(y=acft$`Length of Years 18`, x='18 Year')%>%
  #add_trace(y=acft$`Length of Years 19`, x='19 Year')%>%
  add_trace(y=acft$`Length of Years 20`, x='20 Year',name='20 Year Annual Average')%>%
  #add_trace(y=acft$`Length of Years 21`, x='21 Year')%>%
  #add_trace(y=acft$`Length of Years 22`, x='22 Year')%>%
  #add_trace(y=acft$`Length of Years 23`, x='23 Year')%>%
  #add_trace(y=acft$`Length of Years 24`, x='24 Year')%>%
  #add_trace(y=acft$`Length of Years 25`, x='25 Year')%>%
  #add_trace(y=acft$`Length of Years 26`, x='26 Year')%>%
  #add_trace(y=acft$`Length of Years 27`, x='27 Year')%>%
  #add_trace(y=acft$`Length of Years 28`, x='28 Year')%>%
  #add_trace(y=acft$`Length of Years 29`, x='29 Year')%>%
  add_trace(y=acft$`Length of Years 30`, x='30 Year',name='30 Year Annual Average')%>%
  #add_trace(y=acft$`Length of Years 31`, x='31 Year')%>%
  #add_trace(y=acft$`Length of Years 32`, x='32 Year')%>%
  #add_trace(y=acft$`Length of Years 33`, x='33 Year')%>%
  #add_trace(y=acft$`Length of Years 34`, x='34 Year')%>%
  #add_trace(y=acft$`Length of Years 35`, x='35 Year')%>%
  add_trace(y=acft$`Length of Years 40`, x='40 Year',name='40 Year Annual Average')%>%
  layout(title = 'Forward Looking_Linear Average Annual Flow')
  ps

  ps <- plot_ly(acft, y = acft$`Length of Years 1`,x = '1 Year',color = acft$years ,type = "scatter")%>%
    add_trace(y=acft$`Length of Years 2`, x=2)%>%
    add_trace(y=acft$`Length of Years 3`, x=3)%>%
    add_trace(y=acft$`Length of Years 4`, x=4)%>%
    add_trace(y=acft$`Length of Years 5`, x=5)%>%
    add_trace(y=acft$`Length of Years 6`, x=6)%>%
    add_trace(y=acft$`Length of Years 7`, x=7)%>%
    add_trace(y=acft$`Length of Years 8`, x=8)%>%
    add_trace(y=acft$`Length of Years 9`, x=9)%>%
    add_trace(y=acft$`Length of Years 10`, x=10)%>%
    add_trace(y=acft$`Length of Years 15`, x=11)%>%
    add_trace(y=acft$`Length of Years 20`, x=12)%>%
    add_trace(y=acft$`Length of Years 25`, x=13)%>%
    add_trace(y=acft$`Length of Years 30`, x=14)%>%
    add_trace(y=acft$`Length of Years 35`, x=15)%>%
    add_trace(y=acft$`Length of Years 40`, x=16)%>%
    add_trace(y=acft$`Length of Years 45`, x=17)%>%
    add_trace(y=acft$`Length of Years 50`, x=18)%>%
    add_trace(y=acft$`Length of Years 55`, x=19)%>%
    add_trace(y=acft$`Length of Years 60`, x=20)%>%
    add_trace(y=acft$`Length of Years 40`, x=21)%>%
    add_trace(y=acft$`Length of Years 45`, x=22)%>%
    add_trace(y=acft$`Length of Years 50`, x=23)%>%
    add_trace(y=acft$`Length of Years 55`, x=24)%>%
    add_trace(y=acft$`Length of Years 60`, x=25)%>%
    add_trace(y=acft$`Length of Years 40`, x=26)%>%
    add_trace(y=acft$`Length of Years 45`, x=27)%>%
    add_trace(y=acft$`Length of Years 50`, x=28)%>%
    add_trace(y=acft$`Length of Years 55`, x=29)%>%
    add_trace(y=acft$`Length of Years 60`, x=30)%>%
    add_trace(y=acft$`Length of Years 40`, x=31)%>%
    add_trace(y=acft$`Length of Years 45`, x=32)%>%
    add_trace(y=acft$`Length of Years 50`, x=33)%>%
    add_trace(y=acft$`Length of Years 55`, x=34)%>%
    add_trace(y=acft$`Length of Years 60`, x='35 Year')%>%
    layout(title = 'Forward Looking_Linear Average Annual Flow')
  ps

  view(acft)

#Imporant years 1 10 20 30 and 40-----------
   acft_import <- acft$years
   acft_import <- data.frame(acft_import)
   acft_import$`Lengths of Years 1` <-acft$`Length of Years 1`
   acft_import$`Lengths of Years 10` <-acft$`Length of Years 10`
   acft_import$`Lengths of Years 20` <-acft$`Length of Years 20`
   acft_import$`Lengths of Years 30` <-acft$`Length of Years 30`
   acft_import$`Lengths of Years 40` <-acft$`Length of Years 40`
   acft_import$`Lengths of Years 50` <-acft$`Length of Years 50`
   acft_import$`Lengths of Years 60` <-acft$`Length of Years 60`

   names(acft_import) <- sub("acft_import","years",names(acft_import))
  #view(acft_import)


#Plot every 10 yrs by year
   y = list(title ="Annual Average Flow (Acre-Feet/Year)")
   x= list(title = "Year")

  ps <- plot_ly(acft_import,y= acft_import$`Lengths of Years 1`,x=acft_import$years,type = 'scatter',name = '1 Year Annual Average',mode='line')%>%
    add_trace(y=acft_import$`Lengths of Years 10`,x=acft_import$years,name = '10 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 20`,x=acft_import$years,name = '20 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 30`,x=acft_import$years,name = '30 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 40`,x=acft_import$years,name = '40 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 50`,x=acft_import$years,name = '50 Year Annaul Average')%>%
    add_trace(y=acft_import$`Lengths of Years 60`,x=acft_import$years,name = '60 Year Annaul Average')%>%
        layout(title='Annual Averages')

  ps

  ps <- plot_ly(acft,y= acft$`Length of Years 25`,x=acft$years,type = 'scatter',name = '25 Year Annual Average',mode='line')%>%
    add_trace(y=acft$`Length of Years 30`,x=acft$years,name = '30 Year Annual Average')%>%
    add_trace(y=acft$`Length of Years 35`,x=acft$years,name = '35 Year Annual Average')%>%
    #add_trace(y=acft_import$`Lengths of Years 10`,x=acft_import$years,name = '10 Year Annual Average')%>%
    layout(title='Annual Averages',yaxis =y,xaxis = x)

  ps


  ps <- plot_ly(acft_import,y= acft_import$`Lengths of Years 10`,x=acft_import$years,type = 'pointcloud',name = '10 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 20`,x=acft_import$years,name = '20 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 30`,x=acft_import$years,name = '30 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 40`,x=acft_import$years,name = '40 Year Annual Average')%>%
    layout(title='Annual Averages')
  ps

#Histograms---------------------------------------------------------------------------------------------------------------------------------------
  #Histogram #Think about developing more histograms #What type is the question? What can they show us?
  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 10`,x=acft_import$years,type = 'histogram',name = '10 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 20`,x=acft_import$years,name = '20 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 30`,x=acft_import$years,name = '30 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 40`,x=acft_import$years,name = '40 Year Annual Average')%>%
    layout(title='Annual Averages')

  ph
  setwd("~/")
  ph2 <- plot_ly(acft_import,y= acft_import$`Lengths of Years 10`,x=acft_import$years,type = 'histogram2d',name = '10 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 20`,x=acft_import$years,name = '20 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 30`,x=acft_import$years,name = '30 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 40`,x=acft_import$years,name = '40 Year Annual Average')%>%
    layout(title='Annual Averages')

  ph2

  #Contour Histogram
  ph3 <- plot_ly(acft_import,y= acft_import$`Lengths of Years 1`,x=acft_import$years,type = 'histogram2dcontour',name = '1 Year Annual Average')%>%
    layout(title='1 Year Annual Averages')
  ph3

  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 10`,x=acft_import$years,type = 'histogram2dcontour',name = '10 Year Annual Average')%>%
    layout(title='10 Year Annual Averages')
  ph
  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 20`,x=acft_import$years,type = 'histogram2dcontour',name = '20 Year Annual Average')%>%
    layout(title='20 Year Annual Averages')
  ph

  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 30`,x=acft_import$years,type = 'histogram2dcontour',name = '30 Year Annual Average')%>%
    layout(title='30 Year Annual Averages')
  ph

  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 40`,x=acft_import$years,type = 'histogram2dcontour',name = '40 Year Annual Average')%>%
    layout(title='40 Year Annual Averages')
  ph

  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 50`,x=acft_import$years,type = 'histogram2dcontour',name = '50 Year Annual Average')%>%
    layout(title='50 Year Annual Averages')
  ph

  ph <- plot_ly(acft_import,y= acft_import$`Lengths of Years 60`,x=acft_import$years,type = 'histogram2dcontour',name = '60 Year Annual Average')%>%
    layout(title='60 Year Annual Averages')
  ph


#-3D Scatter------------------------------------------------------------------------------------------------------------------------------------------------------

   ps3 <- plot_ly(acft_import,z = 30,y= acft_import$`Lengths of Years 30`,x=acft_import$years,type = 'scatter3d',name = '30 Year Annual Average')%>%
    add_trace(z=10,y=acft_import$`Lengths of Years 10`,x=acft_import$years, name = '10 YearAnnual Average' )%>%
    layout(title='Annual Averages',yaxis =y, xaxis =x)

  ps3

#-----------------------------------------------------------------------------------------------

  ps <- plot_ly(acft_import,y= acft_import$`Lengths of Years 10`,x=acft_import$years,type = 'pointcloud',name = '10 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 20`,x=acft_import$years,name = '20 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 30`,x=acft_import$years,name = '30 Year Annual Average')%>%
    add_trace(y=acft_import$`Lengths of Years 40`,x=acft_import$years,name = '40 Year Annual Average')%>%
    layout(title='Annual Averages')
  ps


  View(Data)
#-Select DATA Years----------------------------------------------------------------

    #Code for selecting data years from Inflows. Selecting 30years and forward for data.

  #Input Monthly Flows

   # One Climate Change Scenario
#a. Stream Flow Hot Dry Trace - Trace 1

   # Two Observed Historical Flows
#a. Good Years 1940-1970 - Trace 2
#b. Duration and Intensity Drought 1930-1960 - Trace 3

   # Three Paleoflows
#a. Duration Drought  1610-1640 - Trace 4
#b. Intensity Drought  1520-1550 - Trace 5
#c. Both Duration and Intensity Drought  1570-1600  - Trace 6

    #Outputting 6 Runs into an excel file, ensure correct format!!

    #Set output file by resetting the work directory
  setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/2 - RiverWare Modeling/Hydrology")

  #Output data to StreamflowData_SelectedScenarios_30years.xlsx


#Input Data

  #Paleo Flows
  library(readxl)
  ModelInflowsPaleo <- read_excel("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/2 - RiverWare Modeling/Hydrology/ModelInflowsPaleo.xlsx")
  View(ModelInflowsPaleo)

# Return to code directory
setwd(fCodeDir)
