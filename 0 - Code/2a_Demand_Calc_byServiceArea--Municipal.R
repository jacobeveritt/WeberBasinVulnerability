# *------------------------------------------------------------------
# | PROGRAM NAME: Service Area Divided Annual Demands
                                                            #Copy intro page back in when done
#Set Working Directory
setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Service Area Demand Scenarios/Input_Data")

### Clear any existing data or functions.
rm(list=ls())

##Possible package installation necessary
#install.packages("RColorBrewer")
#install.packages("plotly")
#install.packages("readxl")
#install.packages("openxlsx")
library(readxl)
library(plotly)
library(RColorBrewer)
library(openxlsx)

##Input Data Table of Contents##

## Municipal and Industrial water INPUTS
# 1- County Per Capita Usage
# 2- County Populations 2015, 2070, 2150
# 3- County Evapotranspiration
# 4- Per Capita Usage
#a)Indoor Municipal Per Capita: Same, Reduced, Drastically Reduced
#b)Outdoor Municipal Per Capita: Same, Reduced, Drastically Reduced
# 5- Misc.

#----------------------------### Inputs ### ------------------------------------------------------------------------------------------------------------------------------------------
#1 & #2 Inputs By County and Year (Population and Per Capita Usage)
D2015<-read.csv("2015Data.csv")
D2070<-read.csv("2070Data.csv")
D2150<-read.csv("2150Data.csv")

#3 Evapotranspiration
#Evapotranspiration Scenarios
# a. No Change (No Calculation Necessary) (+0% Secondary Usage)
# b. Increased Usage due to Evapotranspiration (High from Seth Arens (High Emissions)= (+10% Secondary Usage)
# c. Increased Usage due to Evapotranspiration (Low Emissions)(+6% Secondary Usage)
ET_High = 1.10
ET_Low = 1.06

#a.                       #No changes

#b.
D2015$ET_High_Secondary.Use <- D2015$Secondary.Use*ET_High
D2070$ET_High_Secondary.Use <- D2070$Secondary.Use*ET_High
D2150$ET_High_Secondary.Use <- D2150$Secondary.Use*ET_High

#c.
D2015$ET_Low_Secondary.Use <- D2015$Secondary.Use*ET_Low
D2070$ET_Low_Secondary.Use <- D2070$Secondary.Use*ET_Low
D2150$ET_Low_Secondary.Use <- D2150$Secondary.Use*ET_Low

#4 Scenarios Input (0%, 25% and 40% reduction)
ScenarioSA_PCntChanges <- read_excel("PercentChanges.xlsx")

#5 Misc Data
#Division of Water Resources Service Area Table
DWRSA_Table <- read_excel("DWRSA_Table.xlsx")
'_________________________________________________________________________________________________________________________________'

####################--Demand Calculations for Differing ET, Populations and Per-Capita Usage Reductions--#########################

#---------------------------------------------##ET Scenario a. No change to Usage due to ET (Same Case)###---------------------------------------

###Calculate Demand_Initial Per Capita values################################################################################################

#Calculate Demand by County For 2015, 2070 and 2150
  #Conversion Factor Gallons per day to Acre-feet per year
      GALtoAF <- 0.0000030688832459704*365

#2015
D2015$MI_County <- ((D2015$Population*D2015$Potable.Use) + (D2015$Population*D2015$Secondary.Use))*GALtoAF

#2070
D2070$MI_County <- ((D2070$Population*D2070$Potable.Use) + (D2070$Population*D2070$Secondary.Use))*GALtoAF

#2150
D2150$MI_County <- ((D2150$Population*D2150$Potable.Use) + (D2150$Population*D2150$Secondary.Use))*GALtoAF

#Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

#2015
D2015$MI_SA <- D2015$MI_County*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

#2070
D2070$MI_SA <- D2070$MI_County*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

#2150
D2150$MI_SA <- D2150$MI_County*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

###PerCapita Percent Changes (PCDecrease Scenario)###############################################################################################
  #Change The Input by ScenarioSA_PcntChanges
    #Decrease the Potable Use by 10%

DecPotable <- 0.90

#2015
  D2015$DecPotable.Use <- D2015$Potable.Use * DecPotable

#2070
  D2070$DecPotable.Use <- D2070$Potable.Use * DecPotable

#2150
  D2150$DecPotable.Use <- D2150$Potable.Use * DecPotable

#Decrease the Secondary Use by 34% to make total PerCapita reduction 25%

DecSecondary <- (1 - 0.34)

#2015
  D2015$DecSecondary.Use <- D2015$Secondary.Use * DecSecondary

#2070
  D2070$DecSecondary.Use <- D2070$Secondary.Use * DecSecondary

#2150
  D2150$DecSecondary.Use <- D2150$Secondary.Use * DecSecondary

######Calculate Demand Decreased Values###########################################################################################

  #Calculate Demand by County For 2015, 2070 and 2150
  #2015
  D2015$MI_County_PCDec <- ((D2015$Population*D2015$DecPotable.Use) + (D2015$Population*D2015$DecSecondary.Use))*GALtoAF

  #2070
  D2070$MI_County_PCDec <- ((D2070$Population*D2070$DecPotable.Use) + (D2070$Population*D2070$DecSecondary.Use))*GALtoAF

  #2150
  D2150$MI_County_PCDec <- ((D2150$Population*D2150$DecPotable.Use) + (D2150$Population*D2150$DecSecondary.Use))*GALtoAF

###Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

  #2015
  D2015$MI_SA_PCDec <- D2015$MI_County_PCDec*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2070
  D2070$MI_SA_PCDec <- D2070$MI_County_PCDec*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2150
  D2150$MI_SA_PCDec <- D2150$MI_County_PCDec*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

###With Per Capita Percent Changes  (Drastic Decrease (DD))#################################################################

  #Decrease the Potable Use by 20%

  DDPotable <- 0.80

  #2015
  D2015$DDPotable.Use <- D2015$Potable.Use * DDPotable

  #2070
  D2070$DDPotable.Use <- D2070$Potable.Use * DDPotable

  #2150
  D2150$DDPotable.Use <- D2150$Potable.Use * DDPotable

  #Decrease the Secondary Use by 44%

  DDSecondary <- (1 - 0.44)

  #2015
  D2015$DDSecondary.Use <- D2015$Secondary.Use * DDSecondary

  #2070
  D2070$DDSecondary.Use <- D2070$Secondary.Use * DDSecondary

  #2150
  D2150$DDSecondary.Use <- D2150$Secondary.Use * DDSecondary


######Calculate Demand Drastic Decreased Values##############################################################################

  #Calculate Demand by County For 2015, 2070 and 2150
  #2015
  D2015$MI_County_PCDD <- ((D2015$Population*D2015$DDPotable.Use) + (D2015$Population*D2015$DDSecondary.Use))*GALtoAF

  #2070
  D2070$MI_County_PCDD <- ((D2070$Population*D2070$DDPotable.Use) + (D2070$Population*D2070$DDSecondary.Use))*GALtoAF

  #2150
  D2150$MI_County_PCDD <- ((D2150$Population*D2150$DDPotable.Use) + (D2150$Population*D2150$DDSecondary.Use))*GALtoAF

  ###Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

  #2015
  D2015$MI_SA_PCDD <- D2015$MI_County_PCDD*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2070
  D2070$MI_SA_PCDD <- D2070$MI_County_PCDD*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2150
  D2150$MI_SA_PCDD <- D2150$MI_County_PCDD*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)


#----------------------------------- ###ET Scenario b. Increase to Usage due to ET (15% Case)### --------------------------

###Calculate Demand_Initial Per Capita values###################################################################################
    #Calculate Demand by County For 2015, 2070 and 2150

  #2015
  D2015$MI_County_HighET <- ((D2015$Population*D2015$Potable.Use) + (D2015$Population*D2015$ET_High_Secondary.Use ))*GALtoAF

  #2070
  D2070$MI_County_HighET <- ((D2070$Population*D2070$Potable.Use) + (D2070$Population*D2070$ET_High_Secondary.Use))*GALtoAF

  #2150
  D2150$MI_County_HighET <- ((D2150$Population*D2150$Potable.Use) + (D2150$Population*D2150$ET_High_Secondary.Use))*GALtoAF

####Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

  #2015
  D2015$MI_SA_HighET <- D2015$MI_County_HighET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2070
  D2070$MI_SA_HighET <- D2070$MI_County_HighET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2150
  D2150$MI_SA_HighET <- D2150$MI_County_HighET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)


  ###PerCapita Percent Changes (PCDecrease Scenario)#############################################################################
  #Change The Input by ScenarioSA_PcntChanges
  #Decrease the Potable Use by 10%

  #DecPotable Values won't change with ET

  #Decrease the Secondary Use by 34% to make total PerCapita reduction 25%

  DecSecondary <- (1 - 0.34)

  #2015
  D2015$DecSecondary.Use_HighET <- D2015$ET_High_Secondary.Use * DecSecondary

  #2070
  D2070$DecSecondary.Use_HighET <- D2070$ET_High_Secondary.Use * DecSecondary

  #2150
  D2150$DecSecondary.Use_HighET <- D2150$ET_High_Secondary.Use * DecSecondary

  ######Calculate Demand Decreased Values########################################################################################

  #Calculate Demand by County For 2015, 2070 and 2150
  #2015
  D2015$MI_County_PCDec_HighET <- ((D2015$Population*D2015$DecPotable.Use) + (D2015$Population*D2015$DecSecondary.Use_HighET))*GALtoAF

  #2070
  D2070$MI_County_PCDec_HighET <- ((D2070$Population*D2070$DecPotable.Use) + (D2070$Population*D2070$DecSecondary.Use_HighET))*GALtoAF

  #2150
  D2150$MI_County_PCDec_HighET <- ((D2150$Population*D2150$DecPotable.Use) + (D2150$Population*D2150$DecSecondary.Use_HighET))*GALtoAF

  ###Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

  #2015
  D2015$MI_SA_PCDec_HighET <- D2015$MI_County_PCDec_HighET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2070
  D2070$MI_SA_PCDec_HighET <- D2070$MI_County_PCDec_HighET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2150
  D2150$MI_SA_PCDec_HighET <- D2150$MI_County_PCDec_HighET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  ###With Per Capita Percent Changes  (Drastic Decrease (DD))####################################################################

  #Decrease the Potable Use by 20%

  #DDPotable Values won't change with ET

  #Decrease the Secondary Use by 44%

  DDSecondary <- (1 - 0.44)

  #2015
  D2015$DDSecondary.Use_HighET <- D2015$ET_High_Secondary.Use * DDSecondary

  #2070
  D2070$DDSecondary.Use_HighET <- D2070$ET_High_Secondary.Use * DDSecondary

  #2150
  D2150$DDSecondary.Use_HighET <- D2150$ET_High_Secondary.Use * DDSecondary


######Calculate Demand Drastic Decreased Values#################################################################################

  #Calculate Demand by County For 2015, 2070 and 2150
  #2015
  D2015$MI_County_PCDD_HighET <- ((D2015$Population*D2015$DDPotable.Use) + (D2015$Population*D2015$DDSecondary.Use_HighET))*GALtoAF

  #2070
  D2070$MI_County_PCDD_HighET <- ((D2070$Population*D2070$DDPotable.Use) + (D2070$Population*D2070$DDSecondary.Use_HighET))*GALtoAF

  #2150
  D2150$MI_County_PCDD_HighET <- ((D2150$Population*D2150$DDPotable.Use) + (D2150$Population*D2150$DDSecondary.Use_HighET))*GALtoAF


###Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table
  #2015
  D2015$MI_SA_PCDD_HighET <- D2015$MI_County_PCDD_HighET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2070
  D2070$MI_SA_PCDD_HighET <- D2070$MI_County_PCDD_HighET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2150
  D2150$MI_SA_PCDD_HighET <- D2150$MI_County_PCDD_HighET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

#----------------------------------- ###ET Scenario c. Decrease to Usage due to ET (Decrease Case)### ----------------------------
###Calculate Demand_Initial Per Capita values#####################################################################################

  #Calculate Demand by County For 2015, 2070 and 2150
  #Conversion Factor Gallons per day to Acre-feet per year
  GALtoAF <- 0.0000030688832459704*365

  #2015
  D2015$MI_County_LowET <- ((D2015$Population*D2015$Potable.Use) + (D2015$Population*D2015$ET_Low_Secondary.Use))*GALtoAF

  #2070
  D2070$MI_County_LowET <- ((D2070$Population*D2070$Potable.Use) + (D2070$Population*D2070$ET_Low_Secondary.Use))*GALtoAF

  #2150
  D2150$MI_County_LowET <- ((D2150$Population*D2150$Potable.Use) + (D2150$Population*D2150$ET_Low_Secondary.Use))*GALtoAF

##Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table
  #2015
  D2015$MI_SA_LowET <- D2015$MI_County_LowET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2070
  D2070$MI_SA_LowET <- D2070$MI_County_LowET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2150
  D2150$MI_SA_LowET <- D2150$MI_County_LowET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

###PerCapita Percent Changes (PCDecrease Scenario)#################################################################################

  #Change The Input by ScenarioSA_PcntChanges
  #Decrease the Potable Use by 10%

  #DecPotable Values won't change with ET

  #Decrease the Secondary Use by 34% to make total PerCapita reduction 25%

  DecSecondary <- (1 - 0.34)

  #2015
  D2015$DecSecondary.Use_LowET <- D2015$ET_Low_Secondary.Use * DecSecondary

  #2070
  D2070$DecSecondary.Use_LowET <- D2070$ET_Low_Secondary.Use * DecSecondary

  #2150
  D2150$DecSecondary.Use_LowET <- D2150$ET_Low_Secondary.Use * DecSecondary

  ######Calculate Demand Decreased Values###########################################################################################

  #Calculate Demand by County For 2015, 2070 and 2150
  #2015
  D2015$MI_County_PCDec_LowET <- ((D2015$Population*D2015$DecPotable.Use) + (D2015$Population*D2015$DecSecondary.Use_LowET))*GALtoAF

  #2070
  D2070$MI_County_PCDec_LowET <- ((D2070$Population*D2070$DecPotable.Use) + (D2070$Population*D2070$DecSecondary.Use_LowET))*GALtoAF

  #2150
  D2150$MI_County_PCDec_LowET <- ((D2150$Population*D2150$DecPotable.Use) + (D2150$Population*D2150$DecSecondary.Use_LowET))*GALtoAF

###Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table

  #2015
  D2015$MI_SA_PCDec_LowET <- D2015$MI_County_PCDec_LowET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2070
  D2070$MI_SA_PCDec_LowET <- D2070$MI_County_PCDec_LowET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2150
  D2150$MI_SA_PCDec_LowET <- D2150$MI_County_PCDec_LowET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

###With Per Capita Percent Changes  (Drastic Decrease (DD))########################################################################
  #Decrease the Potable Use by 20%

  #DDPotable Values won't change with ET

  #Decrease the Secondary Use by 44%

  DDSecondary <- (1 - 0.44)

  #2015
  D2015$DDSecondary.Use_LowET <- D2015$ET_Low_Secondary.Use * DDSecondary

  #2070
  D2070$DDSecondary.Use_LowET <- D2070$ET_Low_Secondary.Use * DDSecondary

  #2150
  D2150$DDSecondary.Use_LowET <- D2150$ET_Low_Secondary.Use * DDSecondary


  ######Calculate Demand Drastic Decreased Values################################################################################

  #Calculate Demand by County For 2015, 2070 and 2150
  #2015
  D2015$MI_County_PCDD_LowET <- ((D2015$Population*D2015$DDPotable.Use) + (D2015$Population*D2015$DDSecondary.Use_LowET))*GALtoAF

  #2070
  D2070$MI_County_PCDD_LowET <- ((D2070$Population*D2070$DDPotable.Use) + (D2070$Population*D2070$DDSecondary.Use_LowET))*GALtoAF

  #2150
  D2150$MI_County_PCDD_LowET <- ((D2150$Population*D2150$DDPotable.Use) + (D2150$Population*D2150$DDSecondary.Use_LowET))*GALtoAF

###Allocating Demand from County Demand to Service Area Proportionally From DWRSA_Table
  #2015
  D2015$MI_SA_PCDD_LowET <- D2015$MI_County_PCDD_LowET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2070
  D2070$MI_SA_PCDD_LowET <- D2070$MI_County_PCDD_LowET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)

  #2150
  D2150$MI_SA_PCDD_LowET <- D2150$MI_County_PCDD_LowET*(DWRSA_Table$AVG/DWRSA_Table$`SUMS by County`)


###     Outputs    ################################################################################################################
  setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Service Area Demand Scenarios/Output")

#  View(D2015)
#  View(D2070)
#  View(D2150)

#MI ONLY

MI_2015 <- D2015[,c(9,13,17,19,22,25,27,30,33)]
MI_2070 <- D2070[,c(9,13,17,19,22,25,27,30,33)]
MI_2150 <- D2150[,c(9,13,17,19,22,25,27,30,33)]

#add Utah County SA1 Data 35500 to top row
MI_2015[1,]<-35500
MI_2070[1,]<-35500
MI_2150[1,]<-35500

#add SA20 to be 0
MI_2015[20,]<-0
MI_2070[20,]<-0
MI_2150[20,]<-0


colnames(MI_2015) <- paste(colnames(MI_2015),"2015",sep="_")

colnames(MI_2070) <- paste(colnames(MI_2070),"2070",sep="_")

colnames(MI_2150) <- paste(colnames(MI_2150),"2150",sep="_")

MI<- data.frame(c(MI_2015,MI_2070,MI_2150))

#View(MI)

#output to excel
write.xlsx(MI_2015, "MI_2015.xlsx")
write.xlsx(MI_2070, "MI_2070.xlsx")
write.xlsx(MI_2150, "MI_2150.xlsx")

write.xlsx(MI,"MI.xlsx")

#################################################################################################################################################################################################################################################################################################################################################################################################################################################
### Sum Data for plots ###
#################################################################################################################################################################################################################################################################################################################################################################################################################################################

#MI Sums

MISums <- colSums(MI,na.rm=F,dims = 1)
MISums
MISums <-data.frame(MISums)


#SummedScenarios <- data.frame(c(MI2015_Sums,MI2070_Sums,MI2150_Sums))
#row.names(SummedScenarios) <- c("Base","PCDec","PCDD","HighET","PCDec_HighET","PCDD_HighET","LowET","PCDec_LowET","PCDD_LowET")

#2015 Sums
MI2015_Sums <- colSums(MI_2015,na.rm = F, dims = 1)
MI2015_Sums <- data.frame(MI2015_Sums)
#2070 Sums
MI2070_Sums <- colSums(MI_2070,na.rm = F, dims = 1)
MI2070_Sums <- data.frame(MI2070_Sums)
#2150 Sums
MI2150_Sums <- colSums(MI_2150,na.rm = F, dims = 1)
MI2150_Sums <- data.frame(MI2150_Sums)

SummedScenarios <- data.frame(c(MI2015_Sums,MI2070_Sums,MI2150_Sums))
row.names(SummedScenarios) <- c("Base","PCDec","PCDD","HighET","PCDec_HighET","PCDD_HighET","LowET","PCDec_LowET","PCDD_LowET")
RowNames <- c("Base","PCDec_ETSame","PCDrD_ETSame","PCBase_HighET","PCDec_HighET","PCDrD_HighET","PCBase_LowET","PCDec_LowET","PCDrD_LowET")

#################################################################################################################################################################################################################################################################################################################################################################################################################################################
### Plots ###
#################################################################################################################################################################################################################################################################################################################################################################################################################################################

#Barplots
Dates <- c("2015", "2070", "2150")

#Per Capita
plot_ly(data=SummedScenarios,x=RowNames, y= ~ MI2015_Sums ,type = 'bar',name = "2015") %>%
  add_trace(x=RowNames, y= ~ MI2070_Sums,name = "2070") %>%
  add_trace(x=RowNames,y = ~ MI2150_Sums, name = "2150") %>%
  layout(yaxis=list(title = 'M&I Demand (acre-feet)',barmode = 'group'))

## BarPlots without Agriculture
Dates <- c("2015", "2070", "2150")

plot_ly(data = SummedScenarios,x = rownames(SummedScenarios) ,y= SummedScenarios$MI2015_Sums ,type = 'bar', name = '2015' ) %>%
  add_trace(y = SummedScenarios$MI2070_Sums,name = '2070') %>%
  add_trace(y = SummedScenarios$MI2150_Sums,name = '2150') %>%
  layout(yaxis=list(title = 'M&I Demand (acre-feet)',barmode = 'group'))

#Factors Compilation Table

MIAll_Factors<-MI
#View(MIAll_Factors)

#i=1
#while (i<=20) {
 # rownames(MIAll_Factors)[i]<-paste0("Potable PerCapita % Change by",paste0(" SA",i))
  #i=i+1
#}

rownames(MIAll_Factors)[1]<-"Potable PerCapita % Change"
rownames(MIAll_Factors)[2]<-"Secondary PerCapita % Change"
rownames(MIAll_Factors)[3]<-"Avg Reduced PerCapita % Change"
rownames(MIAll_Factors)[4] <-"PerCapita Change by Scenario"
rownames(MIAll_Factors)[5]<-"ET Change by %"
rownames(MIAll_Factors)[6]<-"ET Change by Scenario"
rownames(MIAll_Factors)[7]<-"Population"

MIAll_Factors<-MIAll_Factors[1:7,]

#Potable PERCAPITA Changes
MIAll_Factors[1,]<-rep(c(0,10,20),9)
#Secondary PERCAPITA Changes
MIAll_Factors[2,]<-rep(c(0,34,44),9)
#Avg PERCAPITA Changes
MIAll_Factors[3,]<-rep(c(0,25,40),9)
#PERCAPITA Changes by Scenario Name
MIAll_Factors[4,]<-rep(c("Base PC","2025 Goal PC 25% from 2015","Additional 10% Decrease to PC"),9)
#ET Changes by %
MIAll_Factors[5,]<-rep(c(rep(0,3),rep(10,3),rep(6,3)),3)
#ET Changes by Name
MIAll_Factors[6,]<-rep(c(rep("Base ET",3),rep("Low Emission ET",3),rep("Highest Emission ET",3)),3)
#Population
MIAll_Factors[7,]<-c(rep(sum(na.omit(D2015$Population)),9),rep(sum(na.omit(D2070$Population)),9),rep(sum(na.omit(D2150$Population)),9))

#View(MIAll_Factors)
#Output MIAll_Factors
write.xlsx(MIAll_Factors,"MI_AllFactors.xlsx")

