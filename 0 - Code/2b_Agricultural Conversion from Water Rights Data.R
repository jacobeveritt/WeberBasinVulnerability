#############################################################################
#Input Data
#############################################################################
setwd("~/GitHub/WeberBasinVulnerability/WeberBasinVulnerability/1 - Scenario Processing/Annual Service Area Demand Scenarios/Input_Data")
library(readxl)
WaterRights_Data <- read_excel("WRE_Report_County - 10.23.18.xlsx")
#View(WaterRights_Data)

#############################################################################
#Clean up data
#############################################################################

data <- data.frame(WaterRights_Data)
dim(data)
summary(data)
library(tidyverse)
data <- as_tibble(WaterRights_Data)

WaterRights_Weber <-  data %>% filter(BASIN == "WEBER RIVER", FORE_USES == "I" | FORE_USES == "S" | FORE_USES == "IS" | FORE_USES == "IO",
USES == "D" | USES == "DM" | USES == "M"| USES == "MO"| USES == "DO",FORE_ACFT != 0)

WaterRights_State <- data %>% filter(FORE_USES == "I" | FORE_USES == "S" | FORE_USES == "IS" | FORE_USES == "IO",
                                     USES == "D" | USES == "DM" | USES == "M"| USES == "MO"| USES == "DO",FORE_ACFT != 0)
#only Irrigation to Municipal
WaterRights_State_I2M <- data %>% filter(FORE_USES == "I", USES == "M",FORE_ACFT != 0)

WaterRights_Weber_I2M <- data %>% filter(FORE_USES == "I", USES == "M",FORE_ACFT != 0)

 #note all Fore_ACFT values that equal 0 are neglected 
#############################################################################
#Convert CFS to ACFT
#############################################################################

#Convert FORE_CFS to ACFT
    CFS_ACFT <- WaterRights_Weber$FORE_CFS * (1/43560)*(3600*24*365)
#Sum Converted Fore_CFS and Fore_ACFT
    Sum_FORE <- CFS_ACFT + WaterRights_Weber$FORE_ACFT
#Convert AFTER_CFS to ACFT
    aCFS_ACFT <- WaterRights_Weber$AFTER_CFS *  (1/43560)*(3600*24*365)
#Sum Converted AFTER_CFS and AFTER_ACFT
    Sum_AFTER <- aCFS_ACFT + WaterRights_Weber$AFTER_ACFT

#############################################################################
#Percent Changes
#############################################################################

#Only Before and After ACFT values
Percent_of_ACFT <- (( WaterRights_Weber$AFTER_ACFT)/WaterRights_Weber$FORE_ACFT)*100
Percent_of_ACFT_I2M <- (WaterRights_Weber_I2M$AFTER_ACFT/WaterRights_Weber_I2M$FORE_ACFT)*100
#Calculate Percentage of Summed CFS and ACFT
Percent_of_FORE <- ((Sum_AFTER)/Sum_FORE)*100
    
#Percentage of Statewide
Percent_of_ACFT_Statewide <- (WaterRights_State$AFTER_ACFT/WaterRights_State$FORE_ACFT)*100
Percent_of_ACFT_Statewide_I2M <- (WaterRights_State_I2M$AFTER_ACFT/WaterRights_State_I2M$FORE_ACFT)*100
#----------------------------------------------------------------------------
#Summaries
#----------------------------------------------------------------------------
#summary(Percent_of_ACFT)
#summary(Percent_of_ACFT_I2M)
#summary(Percent_of_SUMMED)
#summary(Percent_of_ACFT_Statewide)
#summary(Percent_of_ACFT_Statewide_I2M)

################### Percent excluding 100's (when the values are the same) #############################
#All conversions -- Weber Distric Area Only
  pdata <- as_tibble(Percent_of_ACFT)
  pnum_ACFT = pdata %>% filter(value!=100)
  summary(pnum_ACFT) #<- Minimum of 63% conversion factor selected from the 1st

#All Data Conversion -- StateWide no negative conversions
  pdata <- as_tibble(Percent_of_FORE)
  pnum_SUMMED = pdata %>% filter(value!=100)
  summary(pnum_FORE)

#Irrigation to Municipal Conversion -- Weber District Area only
  pdata <- as_tibble(Percent_of_ACFT_I2M)
  pnum_ACFT_I2M = pdata %>% filter(value!=100)
  summary(pnum_ACFT_I2M)   #-> Selected Mean Value for implementation (71% Ag Conversion)
  
#Irrigation to Municipal Conversion -- StateWide
  pdata_state <- as_tibble(Percent_of_ACFT_Statewide_I2M)
  pnum_state_I2M = pdata_state %>% filter(value!=100)
  summary(pnum_state_I2M) #-> Selected Mean Value for implementation (71% Ag Conversion)
  
#All Data Conversion -- StateWide
  pdata_state <- as_tibble(Percent_of_ACFT_Statewide)   
  pnum_state = pdata_state %>% filter(value!=100)
  summary(pnum_state)

#view(round(pnum_state,2))

#############################################################################
#Look at Uses Data
#############################################################################

#############################################################################
#
#############################################################################
#Weber Data------------------------------------------------------------------
names(WaterRights_Weber)

# Create contingency table
WR_Weber.tab <- table(WaterRights_Weber$FORE_USES,WaterRights_Weber$USES)
WR_Weber.tab

#Marginal Frequencies
margin.table(WR_Weber.tab,1) #Row (FORE_USES) Frequencies
margin.table(WR_Weber.tab,2) #Column (USES) Frequencies

# Call also get cell, row, and column %
#with rounding to get just 2 decimal places

round(prop.table(WR_Weber.tab),2)  #Cell %
round(prop.table(WR_Weber.tab,1),2)  #row %
round(prop.table(WR_Weber.tab,2),2)  #Column %

#State Data------------------------------------------------------------------
names(WaterRights_Data)

# Create Contingency table
WR_State.tab <- table(WaterRights_Data$FORE_USES,WaterRights_Data$USES)
WR_State.tab

#Marginal Frequencies
margin.table(WR_State.tab,1)  #Rows (FORE_USES) Frequencies
margin.table(WR_State.tab,2)  #Columns (USES) Frequencies

# Call also get cell, row, and column %
#with rounding to get just 2 decimal places

round(prop.table(WR_State.tab),2)  #Cell %
round(prop.table(WR_State.tab,1),2)  #row %
round(prop.table(WR_State.tab,2),2)  #Column %

#############################################################################
#Plot
#############################################################################






#############################################################################
#Output
#############################################################################

write.csv(WaterRights_Weber, file = "WaterRights_Weber.csv")

#############################################################################
#############################################################################
